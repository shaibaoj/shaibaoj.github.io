var vmToolEx=new Vue({el:"#vmToolEx",data:{goodsId:"",Bjurl:"",oindexGoodsId:""},mounted:function(){},methods:{copy:function(){var clipboardBtn=new ClipboardJS(".tool-copy",{target:function(trigger){return document.querySelector("#result")}});clipboardBtn.on("success",function(e){e.clearSelection(),clipboardBtn.destroy(),layer.msg("复制成功",{time:2e3})}),clipboardBtn.on("error",function(e){return layer.msg("您的浏览器不支持一键复制，请升级浏览器或更换浏览器",{icon:2})})},generate:function(){$this=$(this),$this.attr("disabled","disabled"),$this.text("解析口令中....."),$(".token_result").hide();var taoken=$("#taoken").val(),captcha=$("#captcha").val();"0"!=taoken&&""!=taoken&&null!=taoken?$.ajax({url:URLPrefix.api_url+"/api/user/tools/tools/token",type:"POST",data:{content:taoken,captcha:captcha,times:URLPrefix.times,url_sign:URLPrefix.url_sign,member_token:URLPrefix.token},dataType:"json",success:function(data){0==data.info.status?($("#url").val(data.data.token.url),$("#content").val(data.data.token.content),$("#pic_url").val(data.data.token.pic_url),$(".token_result").show(),layer.msg("恭喜，生成已成功！",{icon:1})):layer.msg(data.info.status_err,{icon:2}),$("img",$(".verification-captcha")).attr("src","/showpic?a="+Math.random()),$this.removeAttr("disabled"),$this.text("解析口令")}}):(layer.msg("请先输入要解析的口令！",{icon:2}),$this.removeAttr("disabled"),$this.text("解析口令"))},queryPids:function(){$("#pidnumin").html(""),$("tbody",$(".table-pid")).html(""),$.ajax({url:URLPrefix.api_url+"/api/user/user/pid/list",type:"POST",data:{times:URLPrefix.times,url_sign:URLPrefix.url_sign,member_token:URLPrefix.token},dataType:"json",success:function(data){if(0==data.info.status){var html="",tableHtml="";data.data.items&&0<data.data.items.length?($("#pidnumin").show(),$.each(data.data.items,function(i,item){html=html+'<option value="'+(null!=item.pid?item.pid:"")+'" '+(null!=item.selected&&"1"==item.selected?" selected":"")+">"+(null!=item.pid_name?item.pid_name:"")+"</option>",tableHtml=tableHtml+"<tr><td>"+item.pid_name+"</td><td>"+item.pid+'</td><td><a data-id="'+item.user_pid_id+'" class="btn btn-outline-secondary btn-sm btn-del-pid">删除</a></td></tr>'}),$("#pidnumin").html(html),$("tbody",$(".table-pid")).html(tableHtml)):$("#pidnumin").hide()}}})},generateWenan:function(){$this=$(this),$this.attr("disabled","disabled"),$this.text("文案生成中,请稍候...");var linkQuery=$("#linkQuery").val(),pidnumin=$("#pidnumin").val();"0"!=pidnumin&&""!=pidnumin&&null!=pidnumin?$.ajax({url:URLPrefix.api_url+"/api/user/tools/tools/transform",type:"POST",data:{ajax:1,content:linkQuery,pid:pidnumin,times:URLPrefix.times,url_sign:URLPrefix.url_sign,member_token:URLPrefix.token},dataType:"json",success:function(data){if(0==data.info.status){var toolimg="";for(i=0;i<data.data.goods.goods.picList.length;i++)toolimg=toolimg+'<li class="fadein" id="liact'+i+'"><a href="javascript:;" rel="nofollow"><img src="'+data.data.goods.goods.picList[i]+'" id="itempic'+i+'"></a></li>';$("#tool-itempic").html(toolimg),$("#result").html(data.data.content),layer.msg("恭喜，生成已成功！",{icon:1})}else layer.msg(data.info.status_err,{icon:2});$("#wenanbtn").removeAttr("disabled"),$("#wenanbtn").text("生成文案")}}):(layer.msg("抱歉，未检测到PID,请先设置PID！",{icon:2}),$("#wenanbtn").removeAttr("disabled"),$("#wenanbtn").text("生成文案"))},addPid:function(){$this=$(this),$this.attr("disabled","disabled"),$this.text("添加中...");var pid_name=$("#pid_name").val(),pid_pid=$("#pid_pid").val();"0"!=pid_pid&&""!=pid_pid&&null!=pid_pid?$.ajax({url:URLPrefix.api_url+"/api/user/user/pid/update",type:"POST",data:{name:pid_name,pid:pid_pid,times:URLPrefix.times,url_sign:URLPrefix.url_sign,member_token:URLPrefix.token},dataType:"json",success:function(data){0==data.info.status?(queryPids(),$("#pid_name").val(""),$("#pid_pid").val(""),layer.msg("恭喜，生成已成功！",{icon:1})):layer.msg(data.info.status_err,{icon:2}),$this.removeAttr("disabled"),$this.text("添加")}}):(layer.msg("抱歉，pid不能为空！",{icon:2}),$this.removeAttr("disabled"),$$this.text("添加"))},delPid:function(){$(this);var $target=$(event.target);if($target.is(".btn-del-pid")){var user_pid_id=$target.data("id");"0"!=user_pid_id&&""!=user_pid_id&&null!=user_pid_id&&$.ajax({url:URLPrefix.api_url+"/api/user/user/pid/delete",type:"POST",data:{id:user_pid_id,times:URLPrefix.times,url_sign:URLPrefix.url_sign,member_token:URLPrefix.token},dataType:"json",success:function(data){queryPids()}})}}}});