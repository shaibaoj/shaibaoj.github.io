!function($){var base={init:function(){},query_order:function(){$.post(cms_config.s+"/cms/member/order/list",{app_id:cms_config.app_id,url_sign:cms_config.url_sign,time:cms_config.time,page_platform:"cms",hpt_token:window.localStorage.getItem("token"),action:"member"},function(data){var html_list="";data.data.items&&$.each(data.data.items,function(i,item){html_list=html_list+"<li><div><span>"+item.create_date+"</span><span>"+item.money+"元</span><span>"+item.points+"</span><span>"+item.status_name+"</span><span>"+item.memo+"</span></div></li>"}),$("#member_list").html(html_list)})},query_point:function(){$.post(cms_config.s+"/cms/member/point/list",{app_id:cms_config.app_id,url_sign:cms_config.url_sign,time:cms_config.time,maxPoints:.01,action:"point",page_platform:"cms",hpt_token:window.localStorage.getItem("token")},function(data){var html_list="";data.data.items&&$.each(data.data.items,function(i,item){html_list=html_list+"<li><div><span>"+item.create_date+"</span><span>"+item.points+"</span><span>"+item.status_name+"</span><span>"+item.pay_memo+"</span></div></li>"}),$("#member_list").html(html_list)})},query_cash:function(){$.post(cms_config.s+"/cms/member/payment/list",{app_id:cms_config.app_id,url_sign:cms_config.url_sign,time:cms_config.time,action:"cash",page_platform:"cms",hpt_token:window.localStorage.getItem("token")},function(data){var html_list="";data.data.items&&$.each(data.data.items,function(i,item){html_list=html_list+"<li><div><span>"+item.create_date+"</span><span>"+item.money+"元</span><span>"+item.status_name+"</span><span>"+item.pay_memo+"</span></div></li>"}),$("#member_list").html(html_list)})},query_click:function(){$(".mall-click").each(function(i,o){$this=$(o),$click_item=cms_config.click_url,$click_item=$click_item+"?url="+encodeURIComponent($this.data("url")),$click_item=$click_item+"&mall_id="+$this.data("mallid"),$click_item=$click_item+"&u_id="+$this.data("uid"),$click_item=$click_item+"&p_id="+$this.data("pid"),$click_item=cms_config.agent_id&&""!=cms_config.agent_id?$click_item+"&a_id="+cms_config.agent_id:$click_item+"&a_id="+$this.data("aid"),$click_item=$click_item+"&m_id="+cms_config.m_id,$this.attr("href",$click_item)})},query_agent:function(){$.post(cms_config.login_url,{app_id:cms_config.app_id,url_sign:cms_config.url_sign,time:cms_config.time,action:"agent",page_platform:"cms",hpt_token:window.localStorage.getItem("token"),base_url:cms_config.base_url,cms_host:cms_config.cms_host},function(data){data.user_agent&&data.user_agent.agent_url&&""!=data.user_agent.agent_url&&($("#agent_url").show(),$("#agent_url .agent_url").html(data.user_agent.agent_url))})}};window.HPT_MEMBER=base,window.HPT_MEMBER.init()}(jQuery),$(function(){$.post(cms_config.s+"/cms/member/member/info",{app_id:cms_config.app_id,url_sign:cms_config.url_sign,time:cms_config.time,ag_id:$("#member_agent_id").val(),hpt_token:window.localStorage.getItem("token"),page_platform:"cms",action:"info"},function(data){data.data.user.id?($(".app_member_login").hide(),$(".app_member").show(),cms_config.m_id=data.data.user.id):($(".app_member_login").show(),$(".app_member").hide()),data.data.user_data&&(0<$("#member_money").length&&$("#member_money").html(data.data.user_data.money),0<$("#member_money_available").length&&$("#member_money_available").html(data.data.user_data.money_available),0<$("#member_points").length&&$("#member_points").html(data.data.user_data.points),0<$("#member_points_available").length&&$("#member_points_available").html(data.data.user_data.points_available)),0<$("#member-qq").length&&$("#member-qq").val(data.data.user.qq),0<$("#member-email").length&&$("#member-email").val(data.data.user.email),0<$("#member-mobile").length&&$("#member-mobile").val(data.data.user.mobile),0<$("#member-alipay").length&&$("#member-alipay").val(data.data.user.alipay),HPT_MEMBER.query_click()})}),$(function(){$("#btn-register").click(function(){$.post(cms_config.s+"/cms/register/get_token",{app_id:cms_config.app_id,url_sign:cms_config.url_sign,time:cms_config.time,action:"register",user_name:$("#user_name").val(),passwd:$("#password").val(),qq:$("#qq").val(),mobile:$("#mobile").val(),email:$("#email").val(),page_platform:"cms"},function(data){0==data.info.status?(localStorage.setItem("token",data.data.token),window.location.href=cms_config.base_url):$("#user_name_warn").html('<strong class="error "></strong><p class="msg_error">'+data.info.status_err+"</p>")})}),$("#btn-login").click(function(){$.post(cms_config.s+"/cms/token/login",{app_id:cms_config.app_id,url_sign:cms_config.url_sign,time:cms_config.time,action:"login",username:$("#user_name").val(),password:$("#password").val(),page_platform:"cms"},function(data){0==data.info.status?(localStorage.setItem("token",data.data.token),window.location.href=cms_config.base_url):$("#user_name_warn").html('<strong class="error "></strong><p class="msg_error">'+data.info.status_err+"</p>")})}),$("#btn_logout").click(function(){window.localStorage.removeItem("token"),window.location.href=cms_config.base_url}),$(".tb-btn").click(function(){$.post(cms_config.s+"/cms/member/order/input",{app_id:cms_config.app_id,url_sign:cms_config.url_sign,time:cms_config.time,action:"input_taobao_order",order_no:$("#activate-code").val(),page_platform:"cms",hpt_token:window.localStorage.getItem("token")},function(data){0==data.info.status?($(".coupon-active>.err").html(data.info.status_err).css("color","#5eb95e").show(),$("#activate-code").val(""),HPT_MEMBER.query_order()):$(".coupon-active>.err").html(data.info.status_err).css("color","#ff464e").show()})}),$(".payment-btn").click(function(){$.post(cms_config.s+"/cms/member/payment/payment",{app_id:cms_config.app_id,url_sign:cms_config.url_sign,time:cms_config.time,action:"input_payment_money",input_payment_money:$("#money-code").val(),page_platform:"cms",hpt_token:window.localStorage.getItem("token")},function(data){0==data.info.status?($(".coupon-active>.err").html(data.info.status_err).css("color","#5eb95e").show(),$("#money-code").val(""),HPT_MEMBER.query_cash()):$(".coupon-active>.err").html(data.info.status_err).css("color","#ff464e").show()})}),$(".exchange-btn").click(function(){$.post(cms_config.s+"/cms/member/point/exchange",{app_id:cms_config.app_id,url_sign:cms_config.url_sign,time:cms_config.time,action:"input_exchange_points",input_exchange_points:$("#point-code").val(),page_platform:"cms",hpt_token:window.localStorage.getItem("token")},function(data){0==data.info.status?($(".coupon-active>.err").html(data.info.status_err).css("color","#5eb95e").show(),$("#point-code").val(""),HPT_MEMBER.query_point()):$(".coupon-active>.err").html(data.info.status_err).css("color","#ff464e").show()})}),$(".setting-btn").click(function(){$.post(cms_config.s+"/cms/member/info/change_all",{app_id:cms_config.app_id,url_sign:cms_config.url_sign,time:cms_config.time,action:"input_setting",email:$("#member-email").val(),qq:$("#member-qq").val(),mobile:$("#member-mobile").val(),alipay:$("#member-alipay").val(),passwd:$("#member-passwd").val(),payee_name:$("#member-payee_name").val(),page_platform:"cms",hpt_token:window.localStorage.getItem("token")},function(data){0==data.info.status?($("#err").html(data.info.status_err).css("color","#5eb95e").show(),$("#point-passwd").val("")):$("#err").html(data.info.status_err).css("color","#ff464e").show()})}),$(".passwd-btn").click(function(){$.post(cms_config.s+"/cms/member/info/change_password",{app_id:cms_config.app_id,url_sign:cms_config.url_sign,time:cms_config.time,action:"input_passwd",new_passwd:$("#member-passwd-new").val(),passwd:$("#member-passwd").val(),page_platform:"cms",hpt_token:window.localStorage.getItem("token")},function(data){0==data.info.status?($("#err").html(data.info.status_err).css("color","#5eb95e").show(),$("#point-passwd").val("")):$("#err").html(data.info.status_err).css("color","#ff464e").show()})}),0<$("#member_home").length&&(HPT_MEMBER.query_order(),HPT_MEMBER.query_agent()),0<$("#member_point").length&&HPT_MEMBER.query_point(),0<$("#member_cash").length&&HPT_MEMBER.query_cash()});