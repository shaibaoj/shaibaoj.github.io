(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{"355":function(e,o,t){"use strict";Object.defineProperty(o,"__esModule",{"value":!0});var n,r=function(){function defineProperties(e,o){for(var t=0;t<o.length;t++){var n=o[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,o,t){return o&&defineProperties(e.prototype,o),t&&defineProperties(e,t),e}}(),i=function get(e,o,t){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,o);if(void 0===n){var r=Object.getPrototypeOf(e);return null===r?void 0:get(r,o,t)}if("value"in n)return n.value;var i=n.get;return void 0!==i?i.call(t):void 0},p=Object.assign||function(e){for(var o=1;o<arguments.length;o++){var t=arguments[o];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},s=_interopRequireDefault(t(0)),a=t(6),l=_interopRequireDefault(a),c=t(95),u=t(96);function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}t(562);var g=null,f=(0,u.connect)(function(e){var o=e.login;return p({},o)})(n=function(e){function Login(e){!function _classCallCheck(e,o){if(!(e instanceof o))throw new TypeError("Cannot call a class as a function")}(this,Login);var o=function _possibleConstructorReturn(e,o){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!o||"object"!=typeof o&&"function"!=typeof o?e:o}(this,(Login.__proto__||Object.getPrototypeOf(Login)).call(this,e));return o.config={"navigationBarTitleText":"登录"},o.getUserInfo=function(e){(0,a.login)().then(function(e){console.log(e),o.props.weapp_code=e.code,o.getSession()})},o.getSession=function(){if(console.log(o.props.weapp_code),""==o.props.weapp_code)return o.showToast("登陆失败，请重试"),!1;o.props.dispatch({"type":"login/save","payload":{"weapp_code":o.props.weapp_code}}),o.props.dispatch({"type":"login/sendSessionCode","payload":{"weapp_code":o.props.weapp_code}}).then(function(){o.getWeappLogin()})},o.getMobile=function(e){var t=e.target.value;o.props.dispatch({"type":"login/save","payload":{"mobile":t}})},o.getCode=function(e){var t=e.target.value;o.props.dispatch({"type":"login/save","payload":{"code":t}})},o.login=function(){if(""==o.props.mobile||11!=o.props.mobile.length||""==o.props.code||4!=o.props.code.length)return o.showToast("请输入有效的手机号或输入有效验证码！"),!1;o.props.dispatch({"type":"login/login","payload":{"code":o.props.code,"mobile":o.props.mobile}})},o.sendSms=function(){if(""==o.props.mobile||11!=o.props.mobile.length)return o.showToast("请输入有效的手机号！"),!1;o.props.dispatch({"type":"login/sendSms","payload":{"mobile":o.props.mobile}}).then(function(){o.setIntervalTime(),o.props.erroMessage&&""!=o.props.erroMessage&&(clearInterval(g),o.showToast(o.props.erroMessage))})},o.setIntervalTime=function(){clearInterval(g);var e=30;g=setInterval(function(){e--,o.props.dispatch({"type":"login/save","payload":{"sending":1,"smsTime":e}}),(0==e||o.props.erroMessage&&""!=o.props.erroMessage)&&(clearInterval(g),o.props.dispatch({"type":"login/save","payload":{"sending":2,"erroMessage":"","smsTime":30}}))},1e3)},o.getVoiceCode=function(){if(""==o.props.mobile||11!=o.props.mobile.length)return o.showToast("请输入有效的手机号！"),!1;o.props.dispatch({"type":"login/sendSmsVoice","payload":{"mobile":o.props.mobile}}).then(function(){o.setIntervalTime(),o.props.erroMessage&&""!=o.props.erroMessage?(clearInterval(g),o.showToast(o.props.erroMessage)):o.showToast("电话拨打中...请留意相关电话")})},o.state={"mobile":"","code":"","weapp_code":"","invite_code":"","token":"","user_name":"","nick_name":"","img_url":"","smsText":"发送验证码","sending":0,"smsTime":30,"erroMessage":""},o}return function _inherits(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+typeof o);e.prototype=Object.create(o&&o.prototype,{"constructor":{"value":e,"enumerable":!1,"writable":!0,"configurable":!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(e,o):e.__proto__=o)}(Login,l.default.Component),r(Login,[{"key":"getWeappLogin","value":function getWeappLogin(){var e=this;(0,a.getUserInfo)({"withCredentials":!0}).then(function(o){e.props.dispatch({"type":"login/loginWeapp","payload":{"data":{"avatarUrl":o.userInfo.avatarUrl,"nickName":o.userInfo.nickName,"openid":o.userInfo.openid,"unionid":o.userInfo.unionid,"city":o.userInfo.city,"province":o.userInfo.province,"country":o.userInfo.country,"language":o.userInfo.language,"sex":o.userInfo.sex,"gender":o.userInfo.gender}}}),l.default.eventCenter.trigger("getInfo",{})})}},{"key":"showToast","value":function showToast(e){(0,a.showToast)({"title":e,"icon":"none"})}},{"key":"componentWillMount","value":function componentWillMount(){console.log(this.$router.params),console.log(this.$router.params.invite_id)}},{"key":"render","value":function render(){var e=this.props,o=e.sending,t=e.smsTime;return l.default.getEnv()===l.default.ENV_TYPE.WEAPP&&this.setState({"sending":o,"smsTime":t}),s.default.createElement(c.View,{"className":"login-page","id":"login-page"},s.default.createElement(c.View,{"className":"bgtopWrap"},s.default.createElement(c.View,{"className":"loginWrap"},s.default.createElement(c.Button,{"className":"button","open-type":"getUserInfo","onGetUserInfo":this.getUserInfo},"微信一键登陆"))))}},{"key":"componentDidMount","value":function componentDidMount(){i(Login.prototype.__proto__||Object.getPrototypeOf(Login.prototype),"componentDidMount",this)&&i(Login.prototype.__proto__||Object.getPrototypeOf(Login.prototype),"componentDidMount",this).call(this)}},{"key":"componentDidShow","value":function componentDidShow(){i(Login.prototype.__proto__||Object.getPrototypeOf(Login.prototype),"componentDidShow",this)&&i(Login.prototype.__proto__||Object.getPrototypeOf(Login.prototype),"componentDidShow",this).call(this)}},{"key":"componentDidHide","value":function componentDidHide(){i(Login.prototype.__proto__||Object.getPrototypeOf(Login.prototype),"componentDidHide",this)&&i(Login.prototype.__proto__||Object.getPrototypeOf(Login.prototype),"componentDidHide",this).call(this)}}]),Login}())||n;o.default=f},"562":function(e,o,t){}}]);