"use strict";define(function(require){var app=require("app");require("moment");app.directive("dingdoneBtnClick",["utils","config","http",function(utils,config,http){return{scope:{options:"=",callback:"&",result:"="},restrict:"EA",templateUrl:"common/directives/dingdone-btn-click.html",link:function($scope){var vm=$scope.vm={};angular.extend(vm,{init:function(){vm.userBuyStute=1,vm.data={},vm.isAppstore(),vm.buyInfo=$scope.options,vm.watchPrice()},isAppstore:function(){$scope.$watch("vm.serverWay",function(){vm.btnloading=!1;var bool="self_ios"==vm.serverWay||vm.buyInfo.buy_ios&&"help_ios"==vm.serverWay||vm.buyInfo.buy_android&&"help_android"==vm.serverWay||"self_android"==vm.serverWay;bool?(console.log(vm.buyInfo,"vm.buyInfo"),"help_ios"==vm.serverWay&&0==vm.buyInfo.iosStatus&&(vm.btnContant="审核中"),"help_ios"==vm.serverWay&&1==vm.buyInfo.iosStatus&&(vm.btnContant="已通过"),"help_ios"==vm.serverWay&&2==vm.buyInfo.iosStatus&&(vm.btnContant="被打回"),"help_android"==vm.serverWay&&0==vm.buyInfo.AndStatus&&(vm.btnContant="审核中"),"help_android"==vm.serverWay&&1==vm.buyInfo.AndStatus&&(vm.btnContant="已通过"),"help_android"==vm.serverWay&&2==vm.buyInfo.AndStatus&&(vm.btnContant="被打回"),"self_ios"==vm.serverWay&&0==vm.buyInfo.selfIosStatus&&(vm.btnContant="审核中"),"self_ios"==vm.serverWay&&1==vm.buyInfo.selfIosStatus&&(vm.btnContant="已通过"),"self_ios"==vm.serverWay&&2==vm.buyInfo.selfIosStatus&&(vm.btnContant="被打回"),"self_ios"==vm.serverWay&&3==vm.buyInfo.selfIosStatus&&(vm.btnContant="立即上架"),"help_ios"==vm.serverWay&&A.isUndefined(vm.buyInfo.iosStatus)&&(vm.btnContant="立即上架"),"help_android"==vm.serverWay&&A.isUndefined(vm.buyInfo.AndStatus)&&(vm.btnContant="立即上架"),"self_ios"==vm.serverWay&&A.isUndefined(vm.buyInfo.selfIosStatus)&&(vm.btnContant="立即上架"),"help_ios"==vm.serverWay&&3==+vm.buyInfo.iosStatus&&!+vm.buyInfo.buy_ios&&(vm.btnContant=""),"help_android"==vm.serverWay&&3==+vm.buyInfo.AndStatus&&!+vm.buyInfo.buy_android&&(vm.btnContant="立即订购"),"help_ios"==vm.serverWay&&3==+vm.buyInfo.iosStatus&&+vm.buyInfo.buy_ios&&(vm.btnContant="立即上架"),"help_android"==vm.serverWay&&3==+vm.buyInfo.AndStatus&&+vm.buyInfo.buy_android&&(vm.btnContant="立即上架")):("help_ios"==vm.serverWay&&!+vm.buyInfo.buy_ios||"help_android"==vm.serverWay&&!+vm.buyInfo.buy_android)&&(vm.btnContant="立即订购"),"self_android"==vm.serverWay&&(vm.btnContant="立即上架"),vm.myAppstoreRecord(),vm.btnloading=!0})},selectWay:function(way){vm.serverWay=way,vm.showMyappStore=!1,"help_ios"==way?(vm.data={way:way},console.log(vm.buyInfo.buy_ios,"vm.buyInfo.buy_ios"),vm.currentDevice="ios",vm.currentWay="help",A.isUndefined(vm.buyInfo.buy_ios)?vm.firstBuyIos=!0:vm.firstBuyIos=!1):"help_android"==way?(vm.data={way:way},vm.currentDevice="android",vm.currentWay="help",A.isUndefined(vm.buyInfo.buy_android)?vm.firstBuyAnd=!0:vm.firstBuyAnd=!1):"self_ios"==way?(vm.data={way:way},vm.currentDevice="ios",vm.currentWay="self"):"self_android"==way&&(vm.data={way:way},vm.currentDevice="android",vm.currentWay="self")},confirm:function(){vm.data.way||(vm.data.way=vm.serverWay,vm.currentDevice="ios",vm.currentWay="help");var is_store="self_ios"==vm.serverWay||vm.buyInfo.buy_ios&&"help_ios"==vm.serverWay||vm.buyInfo.buy_android&&"help_android"==vm.serverWay,self_and="self_android"==vm.serverWay,buy="help_ios"==vm.serverWay&&!+vm.buyInfo.buy_ios||"help_android"==vm.serverWay&&!+vm.buyInfo.buy_android;if(console.log(buy,"buy"),buy&&"立即订购"==vm.btnContant){if("ios"==vm.currentDevice)var client="ios";else if("android"==vm.currentDevice)var client="android";var obj={client:client,buy:!0};vm.callback(obj)}if(self_and){var obj={url:"http://www.haopintui.net/forum.php?mod=viewthread&tid=1037&highlight=安卓",self_and:!0};vm.callback(obj)}if(is_store&&"立即订购"!=vm.btnContant){var obj={data:vm.data,form:!0};vm.callback(obj)}},myAppstore:function(){vm.data.way||(vm.data.way=vm.serverWay),$modalInstance.close(vm.data)},myAppstoreRecord:function(){vm.record={},$("#mystoreRecord").css("display","none"),"help_ios"==vm.serverWay&&vm.buyInfo.iosRecord&&vm.buyInfo.iosRecord.data&&vm.buyInfo.iosRecord.data.length?($("#mystoreRecord").css("display","inline-block"),vm.record.self=0,vm.record.client=2):"help_android"==vm.serverWay&&vm.buyInfo.andRecord&&vm.buyInfo.andRecord.data&&vm.buyInfo.andRecord.data.length?($("#mystoreRecord").css("display","inline-block"),vm.record.self=0,vm.record.client=1):"self_ios"==vm.serverWay&&vm.buyInfo.selfIosRecord&&vm.buyInfo.selfIosRecord.data&&vm.buyInfo.selfIosRecord.data.length&&($("#mystoreRecord").css("display","inline-block"),vm.record.self=1,vm.record.client=2)},callback:function(data){$scope.callback({data:data}),$scope.result=data},goDetialPage:function(){vm.data.record="record_appstore";var obj={self:vm.record.self,client:vm.record.client,record:!0};vm.callback(obj)},close:function(){$modalInstance.close()},watchPrice:function(){$scope.$watch("vm.buyInfo.buy_ios",function(newval){A.isUndefined(newval)||vm.selectWay("help_ios")})}}),vm.init()}}}])});