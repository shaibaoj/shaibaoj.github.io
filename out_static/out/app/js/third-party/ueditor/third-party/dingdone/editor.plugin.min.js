!function(t){t.widget("ueditor.base",{options:{editor:null,config:null,className:""},_create:function(){this.editor=this.options.editor,this.editorBody=this.editor.document.body,this.editorOp=this.editor.options,this.uid=this.editor.uid,this.slide=this.editorOp.slide||!0,this.element.attr({"ueditor-m2o-plugin":this.uid,"class":this.options.className})},_init:function(){this._initAJaxSetUp()},_alert:function(i){var e='<div style="position:fixed;width:600px;left:50%;margin-left:-300px;top:90px;z-index:99999999999999999;" class="alert alert-danger alert-dismissible fade in" role="alert"> <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">×</span></button><span class="alert-msg"></span></div>',n=t(e).appendTo("body");console.log(n),n.find(".alert-msg").text(i),n.alert(),setTimeout(function(){n.alert("close")},2e3)},_initAJaxSetUp:function(){var i=this;t.ajaxSetup({crossDomain:!0,xhrFields:{withCredentials:!0},error:function(t){var e=t.responseJSON;e.error&&i._alert(e.error.message)}})},_template:function(i,e,n,a){i=i||this.options.templateName,e=e||this.options.pluginInfo,n=n||this.element,a=a||{},t.template(i,e.template);var o=t.tmpl(i,a).appendTo(n);return!e.cssInited&&e.css&&(e.cssInited=!0,this.addCss(e.css)),o},addCss:function(i){t("<style/>").attr("style","text/css").appendTo("head").html(i)},position:function(t){this._position=t,this.element.css({left:t.left+"px",top:t.top+"px"})},getPosition:function(i){var e=t(this.editor.iframe).offset(),n=t(i).offset();return{left:e.left+n.left,top:e.top+n.top}},range:function(){return this.editor.selection.getRange()},rangeSelect:function(t){(t||this.range()).select(!0)},rangeSelectNode:function(t){this.rangeSelect(this.range().selectNode(t))},exec:function(t,i){this.editor.execCommand(t,i)},insertHtml:function(t){this.exec("insertHtml",t)},insertImg:function(i,e){var n,a=this,o="";switch(console.log(e,"打印图片信息"),i){case"img":var r=+new Date;o='<img m2o_mark="'+e.id+'"  width_height="'+e.width+"x"+e.height+'" imageid="'+e.id+'" src="'+t.globalImgUrl(e)+'" hash="'+r+'"  class="image"/>',n=function(){var i=t(a.editor.document).find('.image[hash="'+r+'"]')[0];i&&(a.exec("imagefloat","center"),t(i).removeAttr("hash"),a.range().setCursor(!0))};break;case"":}this.insertHtml(o),n&&n()},iframeImageGet:function(i){return t(this.editor.document).find('img.image[imageid="'+i+'"]')},show:function(){this.hideOthers(),this.element.toggleClass("pop-show")},hideAll:function(){var i=t('[ueditor-m2o-plugin="'+this.uid+'"]');i.removeClass("pop-show")},hideOthers:function(){var i=t('[ueditor-m2o-plugin="'+this.uid+'"]').not(this.element);i.removeClass("pop-show")},hide:function(){this.element.removeClass("pop-show")},_checkPlugin:function(i){return!!t.ueditor[i]},hash:function(){return+new Date+""+Math.floor(1e3*Math.random())},_destroy:function(){}}),t.ueditor.pluginDir="dist/js/third-party/ueditor/third-party/dingdone/images",t.ueditor.gPixelRatio=window.devicePixelRatio?window.devicePixelRatio:1;var i={template:'<div class="ump-wrap"><div class="ump-inner"><div class="ump-head"><div class="ump-title"></div><div class="ump-option"><span class="ump-no">关闭</span></div></div><div class="ump-body"></div></div></div>',css:".ump-box{position:absolute;left:50%;top:-1000px; overflow:hidden; opacity:0; z-index:-1; width:254px; margin-left:-127px;background:#fff;border:10px solid #6ea5e8; 1-webkit-transition:all 0.5s ease; 1-moz-transition:all 0.5s ease; 1transition:all 0.5s ease;  }.pop-show{opacity:1; top:97px; z-index:100000;}.ump-wrap{width:2000px;position:relative;min-height:262px;left:0;}.ump-inner{float:left;width:254px;}.ump-head{height:43px; line-height:43px; margin:0 10px; border-bottom:1px solid #e6e6e6;position:relative;cursor:move;}.ump-title{padding-left:10px; font-size:14px;}.ump-option{position:absolute;right:12px;top:11px;z-index:1;}.ump-no{width:13px; height:13px;display:inline-block; font-size:0; cursor:pointer; background:url("+t.ueditor.pluginDir+"/close4.png) no-repeat center center #fff;}",cssInited:!1},e={template:'<div class="editor-slide-wrap"><div class="editor-slide-inner"><div class="editor-slide-head"><div class="editor-slide-title">标题</div><div class="editor-slide-option"><span class="editor-slide-no"></span></div></div><div class="editor-slide-body"></div></div></div>',css:".editor-slide-box{position:fixed;z-index:-1;transition:left .3s;top:61px;width:265px;height: calc(100vh - 60px);overflow:hidden;}.editor-slide-box.pop-show{z-index:1000;}.editor-slide-wrap{left:-267px;width: 2000px;height:100%;position:absolute;transition: left .3s;}.editor-slide-inner{background: #f9f9f9;float:left;border:1px solid #e9e8e6;height:100%;}.editor-slide-head{position:relative;border-bottom:1px solid #e7e7e7;height:43px;line-height:43px;text-align:center;margin:0 10px;}.editor-slide-no{position:absolute;top:5px;right:0;width:30px;height:30px;line-height:30px;cursor:pointer;background:url("+t.ueditor.pluginDir+"/close4.png)no-repeat center;background-size:10px 10px;}.pop-show .editor-slide-wrap{left:0;}",cssInited:!1};t.widget("ueditor.baseWidget",t.ueditor.base,{options:{className:"ump-box",templateName:"base-plugin-template"},_create:function(){this._super(),this._initDom()},_init:function(){this._super();var t=this.slide?"editor-slide":"ump",i={};i["click ."+t+"-ok"]="ok",i["click ."+t+"-no"]="no",this._on(i)},_initDom:function(){this._template("",this.slide?e:i),this.slide&&this.element.removeClass(this.options.className).addClass("editor-slide-box");var n=this.element,a=this.slide?"editor-slide":"ump";if(this.wrap=n.find("."+a+"-wrap"),this.inner=n.find("."+a+"-inner"),this.body=n.find("."+a+"-body"),this.title=n.find("."+a+"-title"),this.okBtn=n.find("."+a+"-ok"),this.noBtn=n.find("."+a+"-no"),this.options.title&&this.setTitle(this.options.title),this.slide){var o=this.editorOp.relyDom;o&&(this.element.offset(t(o).offset()),this.element.height(this.editorOp.slide_height),this.element.width(t(o).outerWidth()));var r=".editor-slide-inner{width:"+this.element.outerWidth()+"px}";t("<style />").html(r).appendTo("head")}else this.element.draggable()},setTitle:function(t){this.title.html(t)},ok:function(){this.element.removeClass("pop-show")},no:function(){this.element.removeClass("pop-show")},showNext:function(i){var e=this.slide?"editor-slide":"ump",n=e+"-inner",a=this.inner.outerWidth(!0),o=t("<div />").appendTo(this.wrap).attr("class",n);this.wrap.css({left:"-="+a+"px"}),i&&t.isFunction(i)&&i(o)},showBack:function(i){var e=this.slide?"editor-slide":"ump",n=e+"-inner",a=this.inner.outerWidth(!0),o=this;this.wrap.css({left:"+="+a+"px"}),setTimeout(function(){o.wrap.find("."+n+":last-child").remove(),i&&t.isFunction(i)&&i()},300)},_destroy:function(){}}),t.ueditor.m2oPlugins=function(){var t=(baidu.editor.utils,baidu.editor.ui),i={plugins:{},add:function(t){var i=t.cmd;this.plugins[i]||(this.plugins[i]=t,this.init(i,t))},init:function(i,e){t[i]=function(n){var a=new t.Button({className:"edui-for-"+i,title:n.options.labelMap.cmd||e.title,theme:n.options.theme,onclick:function(){e.click?e.click(n):n.execCommand(n)}});return t.buttons[i]=a,a}}};return i}(),t.editorPlugin=function(){return window.gAdmin={group_type:"",admin_id:"32727",admin_user:"zhangz",admin_pass:""},{get:function(i,e){!i.m2oPlugins&&(i.m2oPlugins={});var n=window.baseUrl+window.GUID+"/";defaultOption={uploadUrl:n+"material/create",materialListUrl:n+"material",revolveImgUrl:n+"revolveImg&admin_id="+gAdmin.admin_id+"&admin_pass="+gAdmin.admin_pass,waterUrl:n+"water_config_list",saveWaterUrl:n+"create_water_config",referUrl:n+"material/refer",modelUrl:n+"diy-model?type=refer",model_nodeUrl:n+"node?model_id={{model_id}}&&parent_id={{node_id}}",model_materialUrl:n+"record",materialInfoUrl:n+"get_material_info",imgLocalUrl:n+"material/local",extranetVideo:n+"videoUrlParser"};var a=i.m2oPlugins[e],o=t.extend({},defaultOption,i.options.config_interface);return a||(a=i.m2oPlugins[e]=t("<div/>").appendTo(".ueditor-outer-wrap")[e]({editor:i,config:o}).addClass(e+"-outer")),a},check:function(t,i){return t.m2oPlugins[i]}}}();var n="/*ueditor编辑器样式覆盖*/";!function(){var i={};!function e(){t.each(UE.instants,function(e,a){i[e]||(i[e]=!0,a.callbacks=new t.Callbacks,a.ready(function(){a.options.imagePopup=!1,this.addListener("selectionchange",function(t,i,e){this.callbacks.fire(t,i,e)}),t("<style />").appendTo("head").html(n)}))}),setTimeout(e,500)}()}(),t.globalImgUrl=function(t,i,e,n){var a=1,n="?"+parseInt(1e5*Math.random());return"qiniu"!=t.source&&"upyun"!=t.source||(t.host&&(url=t.host+t.dir+t.filepath+t.filename+"?imageView2/"+a),i&&(url+="/w/"+i),e&&(url+="/h/"+e)),"youzan"==t.source&&t.host&&(url=t.host+t.dir+t.filepath+t.filename),t.source&&"material"!=t.source||(i?url=t.host+t.dir+i+"x"+e+"/"+t.filepath+t.filename+n:url=t.host+t.dir+t.filepath+t.filename+n),url}}(jQuery),function(t){var i={template:'<p style="padding:10px 20px;">抱歉，视频功能暂不可用，感谢您的耐心等待</p>',css:".video-wrap{text-align:center;padding:20px 10px;}.video-wrap .video-url{height:60px;width:100%;font-size:12px;border-color:#cfcfcf;outline:none;resize:none;}.video-wrap .submit-btn{cursor:pointer;display:block;border:1px dashed #d2d3d5;color:#9c9c9c;font-size:14px;width:95px;height:31px;line-height:31px;margin:0 auto;padding:0 30px;background:#f5f6f8;}",extranetImgCss:'.extranet-prev-box{position:relative;width:auto;height:auto;display:inline-block;}.extranet-prev-box:after{position:absolute;content:"";top:50%;left:50%;width:50px;height:50px;margin:-25px 0 0 -25px;background:url('+t.ueditor.pluginDir+"/video_play.png) no-repeat;}",cssInited:!1};t.widget("ueditor.extranetvideo",t.ueditor.baseWidget,{options:{title:"添加外部视频"},_create:function(){this._super(),this._template("video_tpl",i,this.body)},_init:function(){this._super(),this._on({"click .submit-btn":"_submitUrl"})},_submitUrl:function(i){var e=t(i.currentTarget),n=this,a=this.options.config.extranetVideo,o=t.trim(this.element.find("textarea").val());return o?void t.globalAjax(e,function(){return t.getJSON(a,{url:o},function(i){if(n.element.find("textarea").val(""),i.error)return void e.Tips({string:i.msg});e.Tips({string:"上传成功！正在生成预览图...",width:180,dleft:-80,delay:2e3});var a=new Image;a.src=t.globalImgUrl(i.img,"640x"),a.onload=function(){setTimeout(function(){var t='<p><br /></p><p style="text-align:center;" contenteditable="false"><span class="extranet-prev-box"><img class="extranet-prev-pic" imageid="'+i.img.id+'" src="'+a.src+'" title="'+i.title+'" _m3u8="'+i.m3u8+'" _swf="'+i.swf+'" _videourl="'+i.url+'"/></span></p>';n.editor.execCommand("insertHtml",t)},1500)}})}):void e.Tips({string:"请填写视频地址"})},ok:function(){this.insertImg("img",{id:258748,host:"http://img.dev.hogesoft.com:233/",dir:"material/publishsys/img/",filepath:"2013/08/",filename:"20130806143016fYhj.jpeg"}),this._super()},_destroy:function(){}}),t.ueditor.m2oPlugins.add({cmd:"extranetvideo",title:"外部视频",click:function(i){t.editorPlugin.get(i,"extranetvideo").extranetvideo("show")}}),function(){var e={};!function n(){t.each(UE.instants,function(t,n){e[t]||(e[t]=!0,n.ready(function(){UE.utils.cssRule("extranetImgCss",i.extranetImgCss,n.document)}))}),setTimeout(n,500)}()}()}(jQuery),function(t){var i={template:'<div class="imginfo-area"><div class="ueditor-imginfo-box"><div class="img-info-item item-with-pic"><div class="img-box"><img src="{{= src}}" imageid="{{= id}}"/></div>{{if (!id)}}<p class="image-info-outer">外部图片</p>{{/if}}</div><div class="img-info-item"><div class="img-item"><label>图片：</label><input type="text" name="image-info-src" class="info-input {{if !id}}image-info-outer{{/if}}" value="{{= src}}" /></div><div class="img-item"><label>链接：</label><input type="text" name="image-info-href" class="info-input" value="{{= href}}" /></div><div class="img-item"><label>标题：</label><input type="text" name="image-info-title" class="info-input" value="{{= title}}" /></div></div><div class="img-info-item"><div class="img-item uii-pp"><label>版式：</label><span type="left"><img src="'+t.ueditor.pluginDir+'/slide/position-left.png"/></span><span type="center"><img src="'+t.ueditor.pluginDir+'/slide/position-middle.png"/></span><span type="right"><img src="'+t.ueditor.pluginDir+'/slide/position-right.png"/></span></div></div><div class="img-info-item"><div class="img-item"><label>缩放：</label><span class="width-slider"></span><span class="image-info-width">{{= oldwidth}}</span>x<span class="image-info-height">{{= oldheight}}</span></div></div><div class="img-info-item"><div class="img-item"><label>间距：</label><span class="margin-slider"></span><em></em></div></div><div class="img-info-item"><div class="img-item img-border-style"><label>边框：</label><span><img style="padding:5px; background-color:#fff; border:1px solid #ddd;" _style="style1" src="{{= src}}" /></span><span><img style="-webkit-border-radius:5px; -moz-border-radius:5px; border-radius:5px;" _style="style2" src="{{= src}}" /></span><span><img style="border:5px solid #fff; -webkit-box-shadow: 0 10px 10px -10px rgba(0, 0, 0, 0.5), 0 1px 4px rgba(0, 0, 0, 0.3);-moz-box-shadow: 0 10px 10px -10px rgba(0, 0, 0, 0.5), 0 1px 4px rgba(0, 0, 0, 0.3);box-shadow: 0 10px 10px -10px rgba(0, 0, 0, 0.5), 0 1px 4px rgba(0, 0, 0, 0.3);" _style="style3" src="{{= src}}" /></span></div></div></div></div>',css:".image-edit-btn{background:rgba(0,0,0,.5);color:#fff;width:100px;text-align:center;padding:5px 0;cursor:pointer;margin:10px auto;display:inline-block;}.image-info-outer{font-size:12px; color:red;text-align:center;margin-top:6px;}.imginfo-area{overflow-y:auto;height:500px;!important;}.img-box img{max-width:160px;min-height:40px;}.img-info-item{margin:0 10px; border-bottom:1px solid #e6e6e6;}.item-with-pic{padding:10px 0;text-align:center;}.img-item{margin:5% 0;padding:0 5px;}.img-item label{font-size:12px; }.img-item input{height:32px;line-height:32px;width:79%;}.img-item em{font-style:normal; }.uii-pp{line-height:2.2em;}.uii-pp span{width:38px; height:100%; padding:5px; line-height:0; position:relative; display:inline-block; margin:8px 5px 8px 0; vertical-align:middle; }.uii-pp span.current{background: url("+t.ueditor.pluginDir+'/ui-current.png) no-repeat 0;}.img-border-style{line-height:2.5em;}.img-border-style label{display:none;}.img-border-style span{display:inline-block; padding:5% 3%;} .img-border-style span.current{background:yellow; }.image-info-width,.image-info-height{font-family:arial;}.img-border-style img{line-height:0; vertical-align:middle; width:45px;}.ui-slider-horizontal .ui-slider-handle[style*="100"]{margin-left:-9px;}.img-item .ui-slider{border-radius:3px;position:relative;display: inline-block; margin-right: 6px; margin-bottom:0px!important;margin-left:0!important;width: 80px; height: 6px; border:0;background:#6d6d6d;}.img-item .ui-slider-handle{ position:absolute;border:0!important;top:-3px!important;width:12px!important;height:12px!important;background:-webkit-linear-gradient(#d0cfcf,#9d9d9d)!important;background:-moz-linear-gradient(#d0cfcf,#9d9d9d)!important;border-radius:50%!important;}',cssInited:!1};t.widget("ueditor.imginfo",t.ueditor.baseWidget,{options:{index:!0,title:"图片属性",selfPluginInfo:i,selfTemplateName:"plugin-imginfo-template"},_create:function(){this._super()},_init:function(){this._super(),this._on({"click .uii-pp span":"_imgFloat","click .img-border-style img":"_borderStyle","blur .info-input":"_addInfo","click .image-edit-btn":"_editPic"}),this._initEdit()},_editPic:function(i){var e=t.editorPlugin.get(this.editor,"imgmanage"),n=t(i.currentTarget),a=n.closest(".img-info-item").find("img").attr("imageid"),o=e.find('.image[imageid="'+a+'"]');o.trigger("mouseenter"),t("#pic-edit-btn").css("z-index","-1").trigger("click")},_imgFloat:function(i){var e=t(i.currentTarget),n=t(this.img),a=e.attr("type"),o=e.parent();e.hasClass("current")?e.removeClass("current"):e.addClass("current").siblings().removeClass("current"),o.data("type",a),this.changeFloat(n,a)},_borderStyle:function(i){var e=t(this.img),n=t(i.currentTarget),a=n.closest("span"),o=n.attr("_style"),r=n.attr("style");a.hasClass("current")?a.removeClass("current"):(a.siblings().removeClass("current"),a.addClass("current")),this.changeStyle(e,o,r)},_addInfo:function(i){img=this.img;var e=t(img),n=t(i.currentTarget),a=n.val();if(n.data("oldval")!=a){n.data("oldval",a);var o=n.attr("name").replace("image-info-","");"href"==o?e.parent().is("a")?e.parent().attr("href",a):e.wrap('<a href="'+a+'" target = "_blank"></a>'):e.attr(o,a)}},_empty:function(){this.body.empty()},refresh:function(i){this.img=i;var e=t(this.img),n=e.closest("a"),a=e.attr("style"),o="";a&&t.each(a.split(";"),function(i,e){var e=e.split(":");"float"==t.trim(e[0])&&(o=t.trim(e[1]),"none"==o&&(o="center"))}),this.datas={src:e.attr("src"),href:n[0]?n.attr("href"):"",oldwidth:e.width(),oldheight:e.height(),title:e.attr("title"),style:e.attr("_style"),direction:o,id:e.attr("imageid")||e.attr("m2o_mark")},this._empty(),this._template(this.options.selfTemplateName,this.options.selfPluginInfo,this.body,this.datas),this.element.find(".imginfo-area").height(this.element.height()-this.title.height()-10),this._getEditorView(),this.element.hasClass("pop-show")||this.show()},changeStyle:function(t,i,e){var i=i||"none";t.attr("_style",i),t.removeAttr("style").attr("style",e),this.changeFloat(t),this.changeMargin(t)},changeFloat:function(t,i){switch(i||(i=this.element.find(".uii-pp").data("type")||"none"),i){case"left":t.css("float","left");break;case"right":t.css("float","right");break;case"center":var e=t.parent();e[0]?e.css("text-align","center"):t.wrap('<div style="text-align:center"></div>'),t.css("float","none");break;default:t.css("float","none")}this.editor.fireEvent("contentChange")},changeWidth:function(i,e){var n=i.attr("style"),a="";n&&t.each(n.split(";"),function(i,e){var e=e.split(":"),n=t.trim(e[0]),o=t.trim(e[1]);n&&o&&"width"!=n&&"height"!=n&&(a+=n+":"+o+";")}),a?i.attr("style",a):i.removeAttr("style"),i.removeAttr("width height").attr("width",e),this.editor.fireEvent("contentChange")},changeMargin:function(t,i){var e=this.element.find(".uii-pp").data("type")||"none";if(void 0!=i||(i=this.element.find(".margin-slider").slider("value")))switch(e){case"left":t.css({"margin-right":i+"px","margin-bottom":i+"px"});break;case"right":t.css({"margin-left":i+"px","margin-bottom":i+"px"});break;case"center":t.css({"margin-top":i+"px","margin-bottom":i+"px"});break;default:t.css({"margin-left":i+"px","margin-right":i+"px"})}},_getEditorView:function(){var i=this,e=this.datas,n=this.img,a=t(n),o=this.element.find(".width-slider").slider({animate:!0,min:10,max:e.oldwidth,step:10,value:e.oldwidth,slide:function(e,n){var r=n.value,s=o.data("max"),l=parseInt(s.Maxheight*(r/s.Maxwidth),10),d=t(this).parent();d.find(".image-info-width").text(r),d.find(".image-info-height").text(l),i.changeWidth(a,r)}}).data("max",{Maxwidth:e.oldwidth,Maxheight:e.oldheight});this.element.find(".margin-slider").slider({create:function(){t(this).addClass("myslider-ui").next().text(0)},animate:!0,min:0,max:50,step:1,value:0,slide:function(e,n){var o=n.value;t(this).parent().find("em").text(o),i.changeMargin(a,o)}});this.element.find(".info-input").each(function(){t(this).data("oldval",t(this).val())});var r=this.element.find(".img-border-style img").filter(function(){return t(this).attr("_style")==e.style}),s=this.element.find(".uii-pp span").filter(function(){return t(this).attr("type")==e.direction});this.element.find(".uii-pp").data("type",e.direction),r.parent().addClass("current"),s.addClass("current")},hide:function(){this._super(),this.img=null},ok:function(){},_initEdit:function(){this.slide||this.element.resizable()},_destroy:function(){}})}(jQuery),function(t){var i={template:"",tip_tpl:'<div class="local-message"></div>',img_tpl:'<img src="${src}" hash="${hash}" style="width:30px; height:30px; "/>',small_animate_tpl:'<div class="small-animate"><img /></div>',tip_css:".small-animate{border:1px dashed #ccc;opacity:0;width:32px;height:32px;float:left;margin:0 2px;}.local-message{max-width:500px!important;overflow:hidden;border:1px solid rgb(255, 154, 0);color:rgb(255, 154, 0);background-color:#fff;padding:10px; border-radius:2px;text-align:center;}",cssInited:!1};t.widget("ueditor.imglocal",t.ueditor.base,{options:{title:"图片本地化"},_create:function(){this._super(),this.editor_head=t(this.editor.document).find("head"),this.editor_body=t(this.editor.document).find("body"),t.template("item_tpl",i.item_tpl)},_init:function(){this._super(),this._initFlagCss(),this.localIndex||(this.localIndex=+new Date),this.srcs=[]},initLocal:function(){var t=this;this._show(),this._html("正在收集需要本地化的图片..."),setTimeout(function(){t.localImg(function(i){i||(t._html("没有发现需要本地化的图片",!0),setTimeout(function(){t._hide()},800)),t.editor.sync()})},1e3)},queryPicsFromWord:function(t){t.find("img")},queryEditorPics:function(){var i=t(this.editorBody).find("img").not(".m2o-pizhu, .image-refer, .image"),e=this;this._showLocalPicsBox("正在收集需要本地化的图片..."),setTimeout(function(){e._handlePics(i)},1e3)},_handlePics:function(i){var e=[],n=this;t(i).each(function(i,a){var o=t(a),r=t.trim(o.attr("src"));r&&0==r.indexOf("http")&&t.inArray(r,n.srcs)==-1&&(n.srcs.push(r),e.push(o))});var a=e.length?e:"没有发现需要本地化的图片";this._showLocalPicsBox(a)},_showLocalPicsBox:function(i){var e=this;if("string"==typeof i)t(".local-message").text(i).show();else if(i instanceof Array){t(".local-message").empty();var n=t(this.editor.iframe).offset();t(i).each(function(){var i=t(this).offset(),a=t(this).clone().appendTo("body");a.css({position:"absolute",top:i.left+n.left+"px",left:i.top-e.editorBody.scrollTop()+n.top+"px",border:"10px solid"})})}},localImg:function(t){var i=this,e=this._localImg(t);if(this.data=[],e){var n=e.processImgs,a=n.length,o=oknum=0;for(i._html("");o<a;){var r=n.shift();if(!r)return!1;var s=e.outerImgs[o];i._insert(r,s,function(){i.tip_dom.css({width:20*a+10+"px"})}),o++}this.doLocalUpload(e,function(t){oknum++,i.data.push(t),oknum==e.len&&i._moreUpload(e)})}},doLocalUpload:function(t,i){for(var e=this,n=t.outerImgs,a=n.length,o=0;o<a;){var r=n.shift();if(!r)return!1;e._ajax(r,t,i),o++}},_moreUpload:function(t){for(var i=this,e=this.data,n=e.length,a=0;a<n;){var o=e[a];if(!o)return!1;o.error?i._error(o.hash):i._ajaxBack(o,t,a,function(e){i._remove(o,o.hash,e),oknum==t.len&&i._close()}),a++}},_ajaxBack:function(i,e,n,a){this._after(i),a&&a(t(".info-list"))},_localImg:function(i){var e=this,n=[],a=[],o=[];if(t(this.editorBody).find("img").each(function(){var i,r=t(this);r.attr("imageid")||r.hasClass("pagebg")||r.hasClass("m2o-pizhu")||r.hasClass("image-refer")||r.attr("m2o_mark")||(i=t.trim(r.attr("src")),i&&0==i.indexOf("http")&&t.inArray(i,n)==-1&&(n.push(i),a.push({src:i,_src:i,hash:++e.localIndex,dom:r}),o.push(r)))}),!a.length&&i)return void i(!1);var r={outerSrcs:n,outerImgs:a,processImgs:o};return r},_ajax:function(i,e,n){var a=this,o=this.options.config.imgLocalUrl;t.post(o,{url:i.src},function(e){var o=e.material;o.hash=+new Date,o.id=o.identifier,o.hash=i.hash,o.oldurl=i.src,n&&n(o);var r='<img m2o_mark="'+o.id+'"  width_height="'+o.width+"x"+o.height+'" imageid="'+o.id+'" src="'+t.globalImgUrl(o)+'" hash="'+o.hash+'" _src="'+t.globalImgUrl(o)+'" hash="'+o.hash+'"  class="image"/>';i.dom.replaceWith(r),t.editorPlugin.get(a.editor,"imgmanage").imgmanage("acceptData",[o]);var s=t(".local-message").find("img").filter(function(){return t(this).attr("hash")==o.hash}).closest("div");a._animateToRight(s),a.editor.sync(),console.log("fireevent contentChange"),a.editor.fireEvent("contentChange")},"json")},_animateToRight:function(i){i.offset(),t(".imgmanage-outer").offset();this.slide&&i.css({transition:"all .3s",margin:"40px 0 0 200px",position:"absolute","-webkit-transform":"scale(2)",opacity:"1"});var e=this.tip_dom;setTimeout(function(){i.remove();var t=e.find("img"),n=t.length?20*t.length+10+"px":"0";e.css({width:n}),t.length||e.hide()},300)},_error:function(i){var e=t(this).find('img[hash="'+i+'"]');e.animate({top:"50px"},100).delay(100).animate({opacity:0},300,function(){t(this).remove()})},_after:function(i){var e=t.globalImgUrl(i),n=this.editor_body.find('img[src="'+i.oldurl+'"]');n.each(function(){var n=t(this).width();t(this).attr({"class":"image",src:e,oldWidth:"640px",hash:i.hash,imageid:i.id}).width(n),t(this).removeAttr("_src")})},_insert:function(i,e,n){var a=t("<div/>").css({border:"1px dashed #ccc",opacity:0,width:"32px",height:"32px","float":"left","margin-right":"-20px"}).appendTo(this.tip_dom).append(t("<img/>").attr({hash:e.hash,src:e.src}).css({width:"32px",height:"32px"}));this._animate(i,e,a),n&&n.call(a)},_animate:function(i,e,n){var a=this.editor_body,o=t(this.editor.iframe).offset(),r=n.offset(),s=i.offset();t('<img class="imgInfo"/>').attr("src",e.src).css({position:"absolute",left:s.left+o.left+"px",top:s.top-a.scrollTop()+o.top+"px","z-index":999,width:i.width()}).appendTo("body").animate({width:"30px",left:r.left+"px",top:r.top+"px"},300,function(){t(this).remove(),n.css("opacity",1)})},_remove:function(i,e,n){var a=this.tip_dom.find('img[hash="'+e+'"]'),o=a.parent(),r=a.offset(),s=n.offset();a.appendTo("body").css({position:"absolute",left:r.left+"px",top:r.top+"px","z-index":1e6,width:"30px",height:"30px"}).animate({left:s.left+"px",top:s.top+"px",width:"160px"},400,function(){t(this).remove()}),o.html("OK")},_close:function(){var t=this,i=this.tip_dom;i.find("img")[0]||(this._html("本地化完成"),setTimeout(function(){t._hide()},1e3))},_html:function(t){this.tip_dom.html(t).css("width","auto")},_show:function(){this.tip_dom.show()},_hide:function(){this.tip_dom.hide(300)},_initFlagCss:function(){t("<style/>").attr("style","text/css").appendTo(this.element).html(i.tip_css);var e=t(".edui-for-imglocal").offset();e.top+=26,t.template("tip_tpl",i.tip_tpl),this.tip_dom=t.tmpl("tip_tpl",{}).css({"z-index":1e4,position:"absolute",top:e.top+"px",left:e.left+"px",display:"none"}).appendTo(this.element)},_destroy:function(){},localSinglePic:function(i){var e=i.target,n=i.img,a=this.options.config.imgLocalUrl,o=n.src,r=this;t.globalAjax(e,function(){return t.post(a,{url:o},function(e){var a=e.material;a.hash=+new Date,a.id=a.identifier,a.oldurl=o,t.editorPlugin.get(r.editor,"imgmanage").imgmanage("acceptData",[a],n);var s='<img m2o_mark="'+a.id+'" width_height="'+a.width+"x"+a.height+'" imageid="'+a.id+'" src="'+t.globalImgUrl(a)+'" hash="'+a.hash+'" _src="'+t.globalImgUrl(a)+'" hash="'+a.hash+'"  class="image"/>';t(n).replaceWith(s),i.callback(),r.editor.sync(),console.log("fireevent contentChange"),r.editor.fireEvent("contentChange")},"json")})}}),t.ueditor.m2oPlugins.add({cmd:"imglocal",title:"图片本地化",click:function(i){t.editorPlugin.get(i,"imglocal").imglocal("initLocal")}})}(jQuery),function(t){var i={template:'<div class="imgmanage-area"><div class="editor-current-img"><!-- <a class="suoyin set-suoyin"></a> --><div class="item-inner-box"><img src="" class="img-item image" _id="" imageid="${id}"/></div><div class="img-indexpic"></div><div class="img-option"><div class="img-option-box"><span class="image-option-left image-option-item" _deg="-90"></span><span class="image-option-right image-option-item" _deg="90"></span></div></div></div><ul class="editor-content-area editor-img-content-area"></ul><div class="editor-upload-area"><span class="upload-btn">添加图片</span><input class="material-history" type="hidden" name="material_history" /><input type="file" multiple class="upload-file" accept="image/*"/></div></div>',item_tpl:'<li class="item-box"  _id="${id}"><img src="${url}" _src="${url}" bigsrc="${url}" class="img-each" _id="${id}"/><input type="hidden" value="${id}" class="material_id" name="material_id[]" /></li>',css:".suoyin{position:absolute;left:-2px;top:-2px;width:16px;height:46px;background:url("+t.ueditor.pluginDir+"/suoyintu-2x.png) no-repeat;cursor:pointer;background-size:16px 46px;}.suoyin:hover, .suoyin-current{background-image:url("+t.ueditor.pluginDir+"/suoyintu-current-2x.png);}.edit-slide-sort{position:absolute;right:50px;cursor:pointer;color:red;font-weight:bold;}.imgmanage-area{margin:15px 10px 0 20px;}.editor-upload-area{margin:10px 2px; font-size:14px; color:#5b98d1;}.editor-current-img{position:relative;width:160px;height:160px; display:inline-block; vertical-align:top; border:1px solid #e0dcdd;background:url("+t.ueditor.pluginDir+"/suoyin-default.png) no-repeat center;}.editor-current-img:hover .img-option{display:block}.editor-img-content-area{display:inline-block; max-height:155px; overflow-y:auto; overflow-x:hidden; width:55px;}.imgmanage-area .upload-file{display:none;}.imgmanage-area .upload-btn{display:inline-block; text-decoration:underline; cursor:pointer}.imgmanage-area .item-box{position:relative; width:30px;height:30px;margin:0 5px 5px; 1-webkit-transition:all .8s; background-color:rgba(255,255,255,0.8);}.imgmanage-area .item-inner-box{1-webkit-backface-visibility:hidden;font-size: 0;display:table-cell;width:160px;height:160px;vertical-align:middle;text-align:center;}.imgmanage-area .item-inner-box img{max-height:160px;max-width:160px;}.imgmanage-area .img-indexpic{cursor:pointer;position:absolute;top:-2px;left:-2px;width:16px;height:46px;background:url("+t.ueditor.pluginDir+"/suoyintu-2x.png) no-repeat;background-size:16px 46px;}.imgmanage-area .item-box:hover .img-indexpic{display:block;}.imgmanage-area .img-indexpic.current{background-image:url("+t.ueditor.pluginDir+"/suoyintu-current-2x.png);}.imgmanage-area .img-option{display:none;position:absolute;left:0;bottom:0;width:100%;height:30px;}.imgmanage-area .item-box:hover .image-option-del{display:block;}.imgmanage-area .img-option-box{height:15px;padding:7px 0 8px 0;background:rgba(120,120,120,0.8);}.image-option-item{display:inline-block; font-size:0;cursor:pointer;width:19px;height:15px;line-height:24px; margin:0 10px; background:url("+t.ueditor.pluginDir+"/left_rotate.png) left center no-repeat;}.image-option-right{background-image:url("+t.ueditor.pluginDir+"/right_rotate.png);}.image-option-left:hover{background-image:url("+t.ueditor.pluginDir+"/left_rotate_hover.png);}.image-option-right:hover{background-image:url("+t.ueditor.pluginDir+"/right_rotate_hover.png);}.imgmanage-area .del-transition{width:0;height:0;margin:0 5px 5px;border:0;}.image-option-del{width:16px; height:16px; position:absolute; z-index:999; font-size:0; top:-5px; right:-5px; margin:0; cursor:pointer; display:none; border-radius:50%; background: url("+t.ueditor.pluginDir+"/icon_close.png) no-repeat center #cdcdcd; background-size:10px 10px;}.item-box.selected{background-color:transparent;}.img-each{width:100%; height:100%; position:absolute; z-index:-1;}",cssInited:!1},e={template:'<div class="edit-slide-button"><span class="upload-btn">添加图片</span><input class="material-history" type="hidden" name="material_history" /><input type="file" style="display:none" multiple="" class="upload-file" accept="image/*"></div><div class="item-list-wrap"></div><div class="item-page-wrap"></div>',item_tpl:'<div class="item-box"><div class="item-inner-box"><a class="suoyin set-suoyin"></a><img m2o_mark="${id}" imageid="${id}" src="${url}" _src="${url}" class="image"></div><div class="nooption-mask"></div><input type="hidden" value="${id}" class="material_id" name="material_id[]" /><img class="loading-img" src="'+t.ueditor.pluginDir+'/loading.gif" /></div>',page_tpl:'<div class="sys-flex-one">{{if current_page > 1 }}<span class="page-btn" data-page="{{= current_page}}" data-type="previous">上一页</span>{{/if}}</div><div class="sys-flex-one">{{if current_page < total_pages }}<span class="page-btn" data-page="{{= current_page}}" data-type="next">下一页</span>{{/if}}</div>',css:".editor-slide-body{height:100%!important;}.edit-slide-sort{position:absolute;left:5px;cursor:pointer;color:red;font-weight:bold;}.edit-slide-button{margin:15px 0 5px 0;}.imgmanage-outer .upload-btn{box-sizing:content-box;cursor:pointer;display:block;border:1px dashed #d2d3d5;color:#9c9c9c;font-size:14px;width:95px;height:31px;line-height:31px;margin:0 auto;padding-left:64px;background:url("+t.ueditor.pluginDir+"/slide-button.png) no-repeat 40px 8px #f5f6f8;}.item-list-wrap{overflow-y:auto;height: calc(100% - 160px)!important;margin-bottom:10px;}.imgmanage-outer .item-box{width:180px;height:130px;border:1px solid #e0dcdd;background:#fff;position:relative;margin:10px auto 10px;text-align:center;line-height:130px;}.imgmanage-outer .item-inner-box{font-size:0}.item-inner-box .suoyin{display:none;position:absolute;left:-2px;top:-2px;width:16px;height:46px;background:url("+t.ueditor.pluginDir+"/suoyintu-2x.png) no-repeat;cursor:pointer;background-size:16px 46px;}.item-inner-box .suoyin:hover, .item-inner-box .suoyin-current{display:block;background-image:url("+t.ueditor.pluginDir+"/suoyintu-current-2x.png);}.item-inner-box img{vertical-align:middle;max-width:180px;max-height:130px;cursor:pointer;}.image-option-box{display:none;position:absolute;bottom:0;height:22px;width:100%;background:rgba(0,0,0,.5);}.item-box:hover .suoyin{display:block;}.item-box:hover .image-option-box{display:block;}.image-option-item{float:left;width:30px;height:22px;cursor:pointer;background:url("+t.ueditor.pluginDir+"/left_rotate.png) center no-repeat;}.image-option-right{background-image:url("+t.ueditor.pluginDir+"/right_rotate.png);}.image-option-del{float:right;background-image:url("+t.ueditor.pluginDir+"/delate.png);}.image-option-left:hover{background-image:url("+t.ueditor.pluginDir+"/left_rotate_hover.png);}.image-option-right:hover{background-image:url("+t.ueditor.pluginDir+"/right_rotate_hover.png);}.image-option-del:hover{background-image:url("+t.ueditor.pluginDir+"/delate_hover.png);}.image-option-del:hover{}.loading-img{position:absolute;width:30px;top:50%;left:50%;margin:-15px 0 0 -15px;}.item-page-wrap{padding-top:10px;width:200px;margin:10px auto 0;}.item-page-wrap .page-btn{cursor:pointer;display:inline-block;margin-left:20px;background:#6bc1f2;color:#fff;padding:4px 10px;}.item-page-wrap .page-btn.disabled{cursor:default;background:#dbdada;}",
cssInited:!1},n='<div id="material_{{= id}}"><input type="hidden" class="material_id" name="material_id[]" value="{{= id}}" /><input type="hidden" name="material_name[]" value="{{= filename}}"/></div>';t.widget("ueditor.imgmanage",t.ueditor.baseWidget,{options:{title:"图片管理"},_create:function(){this._super(),this._template("img-template",this.slide?e:i,this.body),t.template("item_tpl",i.item_tpl),t.template("page_tpl",e.page_tpl),t.template("slide_item_tpl",e.item_tpl),t.template("material_tpl",n)},_init:function(){this._on({"click .img-indexpic":"_setIndex","click .upload-btn":"_upload","click .set-suoyin":"_setSuoyin","click .image-option-item":"_baseHandle","click .edit-slide-sort":"_sort","click .image":"_insertImg","click .item-box":"_setCurrent","click .page-btn":"_pageClick"}),this._super(),this._default(),this.heiInit=!1,this.upload_file_dom=this.element.find(".upload-file")},_default:function(){this.gLoad=[],this.content=this.element.find(".editor-content-area"),this.list=this.element.find(".item-list-wrap"),this.page=this.element.find(".item-page-wrap"),this._initInputFile()},_pageClick:function(i){var e=t(i.currentTarget),n=e.data("page"),a=e.data("type");n="previous"==a?n-1:n+1,this.ajaxMaterial(n)},_initPage:function(i){this.page.html(""),t.tmpl("page_tpl",i).appendTo(this.page),i.total_pages>1?this.page.addClass("sys-flex"):this.page.hide()},ajaxMaterial:function(i){var e=this.options.config.materialListUrl,n=this;i&&(e=e+"?page="+i),this.list.html(""),t.getJSON(e,function(i){var e=i.meta.pagination,i=i.material;if(t.isArray(i)&&i.length){var i=i.reverse();t.each(i,function(t,i){var e=i.uri;i.host=e.host,i.dir=e.dir,i.filename=e.filename,i.filepath=e.filepath,i.width=e.width,i.height=e.height}),n._ajaxUploadAfter(i),n._initPage(e)}})},_initImgList:function(){this.ajaxMaterial()},_initInputFile:function(){var i=this;this.element.find(".upload-file").ajaxUpload({url:i.options.config.uploadUrl,phpkey:"file",filter:function(i){var e=t("#water_config_id").val();i.append("water_config_id",e)},before:function(){i.externalCall&&(i.load=t.globalLoad(i.external))},after:function(e){i.externalCall&&(i.load?i.load():t.noop());var n=[];e.data&&n.push(e.data.material),i._ajaxUploadAfter(n)}})},_upload:function(){this.externalCall=!1;var t=this;setTimeout(function(){t.upload_file_dom.attr("multiple","multiple").trigger("click")},0)},showInputFile:function(t){var i=this;this.externalCall=!0,this.external=t,setTimeout(function(){i.upload_file_dom.removeAttr("multiple").trigger("click")},0)},_ajaxUploadAfter:function(i){var e=[],n=[],a=this;t(".img-item");t.each(i,function(i,o){var r=o;r.url=t.globalImgUrl(o,180,130),o.identifier&&(r.id=o.identifier),n.push(r.id),e.push(r),a._recordImginfo(r),a._insertDom(r)}),this._setImgHistory(n),this.editorOp.needCount&&t('.editor-statistics-item[_type="image"]').find("span").text(this.element.find(".item-box").length),this.externalCall&&this.editor.fireEvent("_uploadSuoyinCallback",e)},_insertDom:function(i){if(this.slide){var e=t.tmpl("slide_item_tpl",i).prependTo(this.list);this._loadImg(e);var n="";n=t("#indexpic").val(),this.externalCall&&(n=i.id),this.editorOp&&n==i.id&&(e.siblings().find(".suoyin").removeClass("suoyin-current"),e.find(".suoyin").addClass("suoyin-current"))}else{t.tmpl("item_tpl",i).appendTo(this.content);var a=this.element.find(".editor-current-img");if(!a.attr("src")){var o=t(".item-box:first-child");o.click()}}},_setImgHistory:function(t){var i=this.element.find(".material-history"),e=i.val(),n=t;e&&(e=e.split(","),n=t.concat(e)),i.val(n.join())},_loadImg:function(t){var i=new Image;i.src=t.find(".image").attr("_src"),i.onload=function(){t.find(".loading-img").hide(),t.find(".image").attr("src",i.src)}},_baseHandle:function(i){var e=t(i.currentTarget);e.hasClass("image-option-del")?this._del(i):this._rotateImg(i)},_rotateImg:function(i){var e=t(i.currentTarget),n=this.options.config.revolveImgUrl,a=this.slide?e.closest(".item-box"):this.element.find(".editor-current-img"),o=a.find(".image"),r=o.attr("imageid"),s=parseInt(e.attr("_deg")),l=this;param={material_id:r,direction:s>0?2:1},a.find(".loading-img").show(),t.getJSON(n,param,function(i){var e=i[0];l._recordImginfo(e),a.find(".loading-img").hide();var n=t.globalImgUrl(e);if(o.attr("src",t.globalImgUrl(e,160,160)),l._preloadImg(n,function(){l._iframeImageRefresh(r,n)}),l.editor.fireEvent("_refreshIndexPic",e),!l.slide){var s=t.globalImgUrl(e,30,30),d=l.element.find(".item-box").filter(function(){return t(this).attr("_id")==r});d.find("img").attr("src",s)}})},_preloadImg:function(i,e){if("array"==t.type(i))t.each(i,function(t,i){var e=new Image;e.src=i});else{var n=new Image;n.onload=function(){e&&e()},n.src=i}},_iframeImageRefresh:function(t,i){var e=this.iframeImageGet(t);e.length&&e.attr("src",i)},_del:function(i){i.stopPropagation();var e=t(i.currentTarget),n=this.slide?e.closest(".item-box"):this.element.find(".editor-current-img"),a=n.find(".image"),o=a.attr("imageid"),r=this,s=this.iframeImageGet(o);s.length?jConfirm("编辑器中已经插入此图片了，如果删除将连同一起删除，是否确定删除？","删除提示",function(i){i&&(r._delCallback(e),s.remove(),t("#material_"+o).remove(),r.editor.focus(),r._isdelIndexPic(e))}):(r._delCallback(e),r._isdelIndexPic(e))},_delCallback:function(i){var e=this.slide?i.closest(".item-box"):this.element.find(".editor-current-img"),n=e.find(".image"),a=n.attr("imageid"),o=this;if(this.slide)e.slideUp(function(){e.remove(),o.editorOp.needCount&&t('.editor-statistics-item[_type="image"]').find("span").text(o.element.find(".item-box").length)});else{var r=i.closest(".item-box");r.hasClass("selected")&&n.removeAttr("src"),r.slideUp(function(){r.remove(),o.editorOp.needCount&&t('.editor-statistics-item[_type="image"]').find("span").text(o.element.find(".item-box").length)})}this._asyncDelmaterialId(a)},_isdelIndexPic:function(t){if(this.slide){var i=t.closest(".item-box").find(".set-suoyin").hasClass("suoyin-current");i&&this.editor.fireEvent("_setIndex",null)}},_asyncDelmaterialId:function(i){t('input[_id="'+i+'"]').remove()},_insertImg:function(i){var e=t(i.currentTarget),n=e.attr("imageid"),a=this.imgCollection[n];this.insertImg("img",a),this.editorOp.needCount&&t.editorPlugin.get(this.editor,"editorCount").editorCount("refresh")},_sort:function(i){var e=t(i.currentTarget),n=e.attr("state"),n="shang"==n?"xia":"shang";e.html(e.attr(n)),e.attr("state",n);var a=this.slide?this.list:this.element.find(".editor-img-content-area"),o=a.find(".item-box");if(o.length){var r=null;o.each(function(){r?t(this).insertBefore(r):t(this).appendTo(a),r=this}),r=null}},_recordImginfo:function(t){this.imgCollection=this.imgCollection||{};var i=t.id;this.imgCollection[i]=t},_click:function(i){var e=t(i.currentTarget),n=e.attr("_id"),a=this.imgCollection[n];this.insertImg("img",a)},_setCurrent:function(i){if(!this.slide){var e=t(i.currentTarget),n=e.attr("_id");if(!e.hasClass("selected")){e.addClass("selected").siblings().removeClass("selected");var a=e.find("img").attr("_src"),n=e.attr("_id"),o=t.globalLoad(e),r=new Image;r.src=a,r.onload=function(){o()},this.element.find(".image").attr({src:a,_id:n,imageid:n}),t(".index-pic").val(n),this.element.find(".editor-current-img").attr("_id",n)}}},_setIndex:function(i){var e=(this.options,t(i.currentTarget)),n=e.closest(".editor-current-img"),a=n.attr("_id"),o=this.imgCollection[a];e.hasClass("current")?o=null:n.siblings().find(".img-indexpic").removeClass("current"),e.toggleClass("current"),this.editor.fireEvent("_setIndex",o)},_setSuoyin:function(i){var e=t(i.currentTarget),n=e.siblings(".image").attr("imageid"),a=e.hasClass("suoyin-current")?null:this.imgCollection[n];this.element.find(".set-suoyin").not(e).removeClass("suoyin-current"),e.toggleClass("suoyin-current"),this.editor.fireEvent("_setIndex",a)},refreshPic:function(i,e){var n=t(i).attr("imageid"),a=t.globalImgUrl(e,"",!0);this.element.find('.image[imageid="'+n+'"]').attr("src",a)},refreshPicSrc:function(t){var i=this.element.find('.image[imageid="'+t+'"]'),e=i.attr("src");i.attr("src",e+"?"+(new Date).getTime())},acceptData:function(t,i){this._ajaxUploadAfter(t),this.element.hasClass("pop-show")?this._initImgList():this.show()},show:function(){if(this._super(),!this.heiInit){this.heiInit=!0;var t=this.element.height()-this.title.height()-this.element.find(".edit-slide-button").outerHeight(!0)-15;this.element.find(".item-list-wrap").height(t)}this._initImgList()},count:function(){return},_destroy:function(){}}),t.ueditor.m2oPlugins.add({cmd:"imgmanage",title:"图片管理",click:function(i){t.editorPlugin.get(i,"imgmanage").imgmanage("show")}})}(jQuery),function(t){var i={templateName:"plugin-tip-template",template:'<div class="ueditor-tip-content"><ul><li class="ut-title">设标题</li><li class="ut-keyword">设关键字</li><li class="ut-desc">设摘要</li><li class="ut-link">设链接</li></ul></div>',css:".ueditor-tip-box{opacity:1;padding-top:5px;position:absolute;left:0;top:0;z-index:100000;background:url("+t.ueditor.pluginDir+"/tip/tip_top_bg.png) no-repeat;margin-top:15px;width:65px;}.ueditor-tip-box{}.ueditor-tip-content{background:url("+t.ueditor.pluginDir+"/tip/tip_bottom_bg.png) bottom no-repeat;padding-bottom:5px;}.ueditor-tip-content ul{background:url("+t.ueditor.pluginDir+"/tip/tip_middle_bg.png) repeat-y; margin-bottom:0; }.ueditor-tip-box.hide{opacity:0;-webkit-transition:all .5s;-moz-transition:all .5s;transtion:all .5s;}.ueditor-tip-box li{height:22px;padding:2px 5px;cursor:pointer;text-align:center;line-height:22px;color:#fff;background:url("+t.ueditor.pluginDir+"/tip/tip_fen_bg.png) no-repeat center bottom;}.ueditor-tip-box li:hover{color: #8bc8ff;}.ueditor-tip-box li:last-child{background:none;}",cssInited:!1,space:'<span class="m2o-tip-space" style="position:absolute;margin:0;padding:0;width:1px;height:1px;visibility:hidden;"></span>'};t.widget("ueditor.tip",t.ueditor.base,{options:{className:"ueditor-tip-box"},_create:function(){this._super(),this._template(i.templateName,i),this.element.hide()},_init:function(){this._super();var t=this;this._on({mouseenter:function(){t._transition(!0)},mouseleave:function(){t._transition()}}),this._on({"click .ut-title":"_title","click .ut-keyword":"_keyword","click .ut-desc":"_desc","click .ut-link":"_link","click .ut-pizhu":"_pizhu"})},refresh:function(e,n,a){if(n){var o=this;t.each(["link","pizhu"],function(i,e){t.editorPlugin.check(o.editor,e)&&t.editorPlugin.get(o.editor,e)[e]("focusHide")});var r=this.editor.selection;if(this.selectionText=r.getText(),this.selectionText){var s=r.getRange(),l=t(i.space);s.insertNode(l[0]);try{s.select(!0)}catch(d){}this.position(this.getPosition(l)),l.remove(),this.show()}else{t.editorPlugin.get(this.editor,"imgtip").imgtip("hide"),t.editorPlugin.get(this.editor,"link").link("hide");var p=this._checkImg(r);this._checkLink(r);if(p)return;this.hide(!0),this.hideAll()}}},show:function(){this.element.show().removeClass("hide"),this._transition()},hide:function(t){var i=this.element.addClass("hide");setTimeout(function(){i.hasClass("hide")&&i.hide()},t?0:500)},_transition:function(t){if(clearTimeout(this.delayTimer),!t){var i=this;this.delayTimer=setTimeout(function(){i.hide()},2e3)}},_title:function(){this.editor.fireEvent("_title",this.selectionText,this),this.hide(!0)},_keyword:function(){this.editor.fireEvent("_keyword",this.selectionText,this),this.hide(!0)},_desc:function(){this.editor.fireEvent("_desc",this.selectionText,this),this.hide(!0)},_checkLink:function(t){var i=this.editor.queryCommandValue("link");return!!i&&(t.getRange().selectNode(i),this._position=this.getPosition(i),this.element.find(".ut-link").trigger("click"),!0)},_link:function(i){var e=this.editor.queryCommandValue("link"),n=e?e.getAttribute("_href")||e.getAttribute("href",2):"",a=this.editor.selection.getRange();this.hide(!0),this.rangeSelect(a),this.linkTip=this.linkTip||t.editorPlugin.get(this.editor,"link"),this.linkTip.link("setCurrentRange",a),this.linkTip.link("show",{url:n,pp:this._position}),i.stopPropagation()},_checkImg:function(i){var e=i.getRange().getClosedNode(),n=this.editor.m2oPlugins.imgtip;if(e&&"IMG"==e.tagName){if(t(e).is(".pagebg"))return;return t.editorPlugin.get(this.editor,"imgtip").imgtip("refresh",i,e),!0}n&&n.imgtip("hide")},_pizhu:function(){t.editorPlugin.get(this.editor,"pizhu").pizhu("refresh"),this.hide(!0)},_destroy:function(){}}),function(){var i={templateName:"plugin-tip-link-template",template:'<p>链接地址：</p><input type="text" placeholder="http://"/><span class="ueditor-tip-sc">去除链接</span><span class="ueditor-tip-close"></span>',css:".ueditor-tip-link p{font-size:12px; margin:0; }.ueditor-tip-link{display:none;z-index:10000;position:absolute;left:0;top:0;margin-top:25px;width:320px;padding:3px 10px;height:70px;background:#f9f9f9;border:1px solid #e9e8e6;}.ueditor-tip-link.pop-show{display:block;}.ueditor-tip-link input{width:295px;margin-top:4px;height:36px!important;}.ueditor-tip-link .ueditor-tip-sc{position:absolute;z-index:100;right:26px;top:8px;color:blue;cursor:pointer;}.ueditor-tip-link .ueditor-tip-close{font-size:0;position:absolute;top:0;right:8px;width:20px;height:20px;line-height:20px;cursor:pointer;background:url("+t.ueditor.pluginDir+"/close4.png)no-repeat center;background-size:8px 8px;}",cssInited:!1};t.widget("ueditor.link",t.ueditor.base,{options:{className:"ueditor-tip-link"},_create:function(){this._super(),this._template(i.templateName,i),this.input=this.element.find("input")},_init:function(){this._super();var i=this;this._on(document,{click:function(t){i._show&&i._check(t)}}),t(this.editor.document).on("mousedown",function(){i._show&&i.setLink()}),this._on({"focus input":"_focusInput"}),this._on({"click .ueditor-tip-sc":"delLink","click .ueditor-tip-close":"back"})},setCurrentRange:function(t){this.currentRange=t},_getCurrentRange:function(){return this.currentRange},_focusInput:function(i){t(i.currentTarget),this._getCurrentRange()},_check:function(i){var e=t(i.target);e.closest("."+this.options.className).length||e[0]==this.element[0]||this.setLink()},setLink:function(){this.input.val()&&(this.exec("link",{href:this.input.val()}),this.hide())},delLink:function(){this.exec("unlink"),this.hide()},url:function(t){this.input.val(t)},back:function(){this.hide()},show:function(i){this._super(),this.element.css("display","block");var e=t.trim(i.url);this.url(e),this.position(i.pp),this.element.find(".ueditor-tip-sc")[e.length?"show":"hide"](),this._show=!0,this.element.find("input").focus()},hide:function(){this._super(),this.element.css("display","none"),this._show=!1},focusHide:function(){this._show&&this.setLink()},_destroy:function(){}})}(),function(){var i={templateName:"plugin-imgtip-template",template:'<ul><li class="uit-left">居左</li><li class="uit-center">居中</li><li class="uit-right">居右</li><li class="uit-local">本地化</li><li class="uit-change">修改</li></ul>',css:".uit-change{display:none;}.ueditor-imgtip-box{opacity:0.7;position:absolute;left:10px; top:10px; z-index:100000; background:#000; padding:3px 6px;}.ueditor-imgtip-box{}.ueditor-imgtip-box li{cursor:pointer;float:left;margin-right:5px;height:22px;line-height:22px; color:#fff; font-weight:bold; }",cssInited:!1};t.widget("ueditor.imgtip",t.ueditor.base,{options:{className:"ueditor-imgtip-box"},_create:function(){this._super(),this._template(i.templateName,i);var t=this.element;this.leftBtn=t.find(".uit-left"),this.centerBtn=t.find(".uit-center"),this.rightBtn=t.find(".uit-right"),this.rotateLeftBtn=t.find(".uit-rotatel"),this.rotateRightBtn=t.find(".uit-rotater"),this.localBtn=t.find(".uit-local"),this.changeBtn=t.find(".uit-change")},_init:function(){this._super(),this._on({"click .uit-left":"_left","click .uit-center":"_center","click .uit-right":"_right","click .uit-rotatel":"_rotatel","click .uit-rotater":"_rotater","click .uit-local":"_local","click .uit-change":"_change"})},pp:function(t){this._pp(t)},_pp:function(i){"center"==i?(t(this.img).css("float","none"),t(this.img).parent().css("text-align","center")):t(this.img).css("float",i),"center"==i&&(this.img=this.range().getClosedNode()),this.refreshPosition(),this.editor.fireEvent("contentChange")},_left:function(){this._pp("left")},_center:function(){this._pp("center")},_right:function(){this._pp("right")},_rotate:function(i,e){var n=t(i.currentTarget),a=this.options.config.revolveImgUrl,o="left"==e?1:2,r=t(this.img).attr("imageid")||t(this.img).attr("m2o_mark"),s=this,l={material_id:r,direction:o},d=t.globalLoad(n);t.getJSON(a,l,function(i){d();var e=i[0],n=t.globalImgUrl(e,"640x",!0);t(s.editorBody).find('.image[imageid="'+r+'"]').attr({src:n,_src:n}),t.editorPlugin.get(s.editor,"imgmanage").imgmanage("refreshPicSrc",r),t.editorPlugin.get(s.editor,"imginfo").imginfo("refresh",s.img),s.editor.fireEvent("_refreshIndexPic")})},_rotatel:function(t){this._rotate(t,"left")},_rotater:function(t){this._rotate(t,"right")},_local:function(i){var e=t(i.currentTarget),n=this;t.editorPlugin.get(this.editor,"imglocal").imglocal("localSinglePic",{target:e,img:n.img,callback:function(){n.localBtn.hide(),n.rotateLeftBtn.show(),n.rotateRightBtn.show(),n.refreshPosition()}})},_change:function(){t(this.img).hasClass("image-refer")?t.editorPlugin.get(this.editor,"referinfo").referinfo("refresh",this.img):t(this.img).hasClass("extranet-prev-pic")?t.editorPlugin.get(this.editor,"extranetinfo").extranetinfo("refresh",this.img):t.editorPlugin.get(this.editor,"imginfo").imginfo("refresh",this.img)},refreshPosition:function(){var i=this.getPosition(this.img),e=t(this.img).outerWidth(),n=this.element.outerWidth();i.left+=e-n,this.position(i)},_checkLocalImg:function(){return!!t(this.img).attr("m2o_mark")},refresh:function(i,e){if(this.img=e,t(this.img).hasClass("m2o-pizhu"))return void this.element.hide();for(var n=["image-refer","extranet-prev-pic"],a=!1,o=0,r=n.length;o<r;o++)t(this.img).hasClass(n[o])&&(a=!0);this.element[a?"hide":"show"](),this._checkLocalImg()?(this.localBtn.hide(),this.rotateLeftBtn.show(),this.rotateRightBtn.show()):(this.localBtn.show(),this.rotateLeftBtn.hide(),this.rotateRightBtn.hide()),this.changeBtn.click(),this.refreshPosition()},show:function(){this.element.show()},hide:function(){this.element.hide(),this.img=null},_destroy:function(){}})}(),function(){var i={};!function e(){t.each(UE.instants,function(e,n){i[e]||(i[e]=!0,n.callbacks.add(function(i,e,a){t.editorPlugin.get(n,"tip").tip("refresh",i,e,a)}))}),setTimeout(e,500)}()}()}(jQuery),function(t){var i=["h1","h2","h3"];t.each(i,function(e,n){t.widget("ueditor."+n+"label",t.ueditor.base,{options:{},_create:function(){this._super()},_init:function(){this._super()},show:function(){var i=n;t(".edui-for-"+n+"label > .edui-default").hasClass("edui-state-checked")&&(i="p"),this.exec("Paragraph",i),this.refresh()},refresh:function(e,n,a){var o=this.editor.queryCommandValue("Paragraph");o&&t.each(i,function(i,e){t(".edui-for-"+e+"label > .edui-default")[o==e?"addClass":"removeClass"]("edui-state-checked")})}}),t.ueditor.m2oPlugins.add({cmd:n+"label",title:n+"标签",click:function(i){t.editorPlugin.get(i,n+"label")[n+"label"]("show")}})}),function(){var i={};!function e(){t.each(UE.instants,function(e,n){i[e]||(i[e]=!0,n.callbacks.add(function(i,e,a){t.editorPlugin.get(n,"h1label").h1label("refresh",i,e,a)}))}),setTimeout(e,500)}()}()}(jQuery),function(t){var i={template:'<div class="refer-slide"><div id="edit-slide-each1" class="edit-slide-each"><div class="edit-slide-title">引用素材</div><span class="editor-slide-no"></span><div class="edit-slide-refer-content edit-slide-content" data-sortlevel="0"></div></div></div>',item_tpl:'<div class="refer-item refer-${bundle} edit-slide-next {{if !level}}refer-with-icon{{/if}}" {{if ismodel}}ismodel="true"{{/if}} data-islast="${islast}" data-id="${id}" ><span class="refer-showdata-btn">${name}</span>{{if !islast}}<a class="refer-item-button refer-item-next">&gt;</a>{{/if}}</div>',item_content:'<div class="edit-slide-each"><div class="edit-slide-title">${tit}</div><span class="slide-back">返回</span><span class="editor-slide-no"></span><div class="edit-slide-refer-content edit-slide-content item-list-wrap" data-sortlevel="${sortlevel}">{{tmpl($data["columnlist"]) "item_tpl"}}</div><div class="item-page-wrap"></div></div>',item_data:'<div class="refer-item refer-material-item"><div class="wrap-img" data-id="${id}"><img src="${src}" alt="${alt}" title="${title}" /></div><div class="refer-label"><p class="refer-item-title">${title}</p><p>${update_time}</p></div></div>',page_tpl:'<div class="sys-flex-one">{{if current_page > 1 }}<span class="page-btn" data-page="{{= current_page}}" data-type="previous">上一页</span>{{/if}}</div><div class="sys-flex-one">{{if current_page < total_pages }}<span class="page-btn" data-page="{{= current_page}}" data-type="next">下一页</span>{{/if}}</div>',item_nodata:'<h3 class="nodata">没有此类素材！</h3>',item_nodata_wrap:'<div class="edit-slide-refer-content edit-slide-content item-list-wrap" data-sortlevel="${sortlevel}">{{tmpl($data["columnlist"]) "item_tpl"}}</div>',css:".refer-slide{position:relative; width:11000px; top:-44px;}.edit-slide-each{width:200px; margin:0 10px; float:left; position:relative;}.ump-box .edit-slide-each{width:200px}.refer-slide .search-txt{height:30px;width:100px;vertical-align:middle;line-height:20px;text-indent:4px;}.edit-slide-title{height:43px; line-height:43px;text-align:center;}.slide-back{position:absolute;left:0; top:10px; z-index:99; cursor:pointer; width:22px; height:22px;color:transparent;background: url("+t.ueditor.pluginDir+"/slide/slide-back.png) no-repeat center; }.item-list-wrap{height: calc(100vh - 170px)!important;overflow-y:auto;}.edit-slide-refer-content{overflow-y:auto;}.refer-item{padding:10px; border-bottom:1px solid #e7e7e7; position:relative;  overflow:hidden;}.refer-material-item{padding:10px 0;cursor:pointer;}.refer-item-button{background-position:center;cursor:pointer;width:30px; height:40px; position:absolute;background-repeat:no-repeat;right:4px; top:0px; text-indent:-999px; background-image:url("+t.ueditor.pluginDir+"/slide/slide-next.png); overflow:hidden}.refer-item-button:hover{background-color:#efefef;}.refer-item .refer-item-title{height:36px;overflow:hidden;text-overflow:ellipsis;}.refer-item span{cursor:pointer;width:130px; overflow:hidden;height:20px; display:block; line-height:20px; padding-left:0;}.refer-my_publisth span{background: url("+t.ueditor.pluginDir+"/slide/nav-user-h.png) no-repeat left center;}.refer-my_publisth:hover span{background-image: url("+t.ueditor.pluginDir+"/slide/nav-user.png);}.refer-with-icon.refer-tuji span{background: url("+t.ueditor.pluginDir+"/slide/tw-tjk-h.png) no-repeat left center;}.refer-with-icon.refer-tuji:hover span{background-image: url("+t.ueditor.pluginDir+"/slide/tw-tjk.png);}.refer-with-icon.refer-vote span{background: url("+t.ueditor.pluginDir+"/slide/hd-tp-h.png) no-repeat left center;}.refer-with-icon.refer-vote:hover span{background-image: url("+t.ueditor.pluginDir+"/slide/hd-tp.png);}.refer-with-icon.refer-livmedia span{background: url("+t.ueditor.pluginDir+"/slide/mt-zbt-h.png) no-repeat left center;}.refer-with-icon.refer-livmedia:hover span{background-image: url("+t.ueditor.pluginDir+"/slide/mt-zbt.png);}.wrap-img{margin-top:6px;width:72px; height:70px; line-height:50px; float:left; border:1px solid #E7E7E7; text-align:center; margin-right:10px; cursor:pointer;}.wrap-img img{max-height:70px; max-width:70px; vertical-align:middle; }.refer-label{ display: table-cell; height: 54px; vertical-align: middle; max-width: 100px; word-wrap: break-word;}.refer-label p{color:#9f9f9f; font-size:0.7em; font-family:arial;margin-bottom:2px;}.nodata{color:red; font-size:16px; padding:10px; text-align:center;}.refer-material-search{border-bottom: 1px solid #e7e7e7; line-height: 40px;padding-left: 10px;}.refer-event-submit{margin-left:10px; cursor:pointer; }.page-control{float:right; margin:15px 20px;}.page-control a{margin:10px; cursor:pointer; }.ump-inner .edit-slide-title{background:#fff}.editor-slide-inner .edit-slide-title{background:#f9f9f9}.item-page-wrap{padding-top:10px;width:200px;margin:10px auto 0;}.item-page-wrap .page-btn{cursor:pointer;display:inline-block;margin-left:20px;background:#6bc1f2;color:#fff;padding:4px 10px;}.item-page-wrap .page-btn.disabled{cursor:default;background:#dbdada;}",cssInited:!1};t.widget("ueditor.refer",t.ueditor.baseWidget,{options:{index:!0,title:"引用素材",slide:".refer-slide",eachfirst:"#edit-slide-each1",each:".edit-slide-each",content:".edit-slide-content",mypublish:"refer-my_publisth",eventsubmit:"refer-event-submit",icon:"refer-with-icon",showdataBtn:".refer-showdata-btn",next:".refer-item-next",tit:".edit-slide-title",back:".slide-back",mulpage:".page-btn",wrap:".refer-material-item"},_create:function(){this.editor=this.options.editor,this._super(),this._template("attach-template",i,this.body),this.sortlevel=0,this.content="",this.tit="",this.nextInfo={host:"",dir:"",filename:"",fid:0,sort_id:0,isLast:0},this.typeList={VOD:"vod",TUJI:"tuji",VOTE_QUESTION:"vote_question",VOTE:"vote"},this.page={total:0,needNext:!0,nowCount:0,step:0,cache:null,hasNext:function(){return this.needNext}},this.searchHtml='<div class="refer-material-search"><label>搜索：<input class="search-txt" /></label><a class="refer-event-submit edit-slide-next">确定</a></div>',this.waitingImg='<img class="waiting-img" src="'+t.ueditor.pluginDir+'/loading.gif"/>'},_init:function(){var t=this.options,i={};this.box=this.element.find(t.slide),i["click "+t.showdataBtn]="_showdata",i["click "+t.next]="_showNext",i["click "+t.back]="_back",i["click "+t.mulpage]="_pageClick",i["click .refer-event-submit"]="_searchData",i["click "+t.wrap]="insertRefer",this._on(i),this._initWater(),this._super()},_searchData:function(i){var e=t(i.currentTarget);this.addAjaxB(e)},_showdata:function(i){var e=(this.options,t(i.currentTarget).closest(".refer-item"));e.attr("ismodel")&&(this.model_id=e.data("id"),this.showdata=!0),console.log(this.model_id),0==e.closest(".edit-slide-content").data("sortlevel")&&(this.belongTopSortName=e.find("span").text()),this.addAjaxB(e)},_showNext:function(i){var e=(this.options,t(i.currentTarget)),n=e.closest(".refer-item");this.showdata=!1,n.attr("ismodel")&&(this.model_id=n.data("id")),console.log(this.model_id),0==e.closest(".edit-slide-content").data("sortlevel")&&(this.belongTopSortName=e.find("span").text()),this.addAjaxB(n),i.stopPropagation()},addAjaxB:function(t){var i=this.options,e=this;if(t.hasClass(i.eventsubmit)){if(!t.parent().find("input").val().trim())return void t.myTip({string:"请输入要搜索的内容"});this.content="搜索结果",this.nextInfo.isLast=1,this.nextInfo.model_id=this.model_id,this.nextInfo.key=t.parent().find("input").val().trim(),this.nextInfo.search_type=t.data("search_type"),e.requestAjaxForSearch(t),this.search=!0}else this.nextInfo.isLast=t.data("islast"),this.nextInfo.sort_id=t.data("id"),this.content="我发布的"==this.content&&1!=this.sortlevel?this.content:t.find("span").text(),e.requestAjax(t),this.search=!1},requestAjaxForSearch:function(i){this.sortlevel++;var e=this,n=this.sortlevel,a=this.nextInfo.key,o=this.options.config.model_materialUrl,r=r||0;o+="?model_id="+this.model_id+"&node_id="+this.node_id+"&page="+r+"&keywords="+a,t.globalAjax(i,function(){return t.getJSON(o,function(t){t=t||[],n==e.sortlevel&&(e.addAjaxA(t,!0),e.setreferSlide(i))})})},requestAjax:function(i,e){this.sortlevel++;var n=this.options.config.model_nodeUrl,a=!1,o=this.options,r=this,s=i,l=this.sortlevel,d=!1,p=i.data("id");console.log(p,this.model_id,n),p==this.model_id&&(p=0),this.node_id=p,n=n.replace("{{model_id}}",this.model_id).replace("{{node_id}}",p);s.closest(o.content).data("sortlevel");if(console.log(this.nextInfo,"是否最后"),0!=this.nextInfo.isLast||r.showdata){this.isLast=!0;var n=this.options.config.model_materialUrl,e=e||0;n+="?model_id="+this.model_id+"&node_id="+p+"&page="+e,a=!0}else this.isLast=!1,a=!1;t.globalAjax(i,function(){return t.getJSON(n,function(t){if(a||d)var t=t;else var t=t.nodes||[];l==r.sortlevel&&(r.addAjaxA(t,a),r.setreferSlide(i))})})},addAjaxA:function(t,i){console.log(t,i),i?i&&t.data.length?this.addMaterialList(t):this.showEmpty():this.addSortList(t)},addMaterialList:function(e,n){var a=e.data,o=this,r=this.options,s=(this.sortlevel,e.meta.pagination),l=n||r.slide,d=[],p={};if(t.isArray(a)&&t.each(a,function(t,i){o.preloadImg(i,d)}),p.columnlist=d,p.sortlevel=this.sortlevel,p.tit=this.content,n)t.template("item_tpl",i.item_data),t.tmpl("item_tpl",d).appendTo(l);else{t.template("item_tpl",i.item_data),t.template("item_content",i.item_content);t.tmpl("item_content",p).appendTo(l)}this._initPage(s)},preloadImg:function(i,e){console.log(i,e,"hello");var n={},a=i.data;console.log(a,"list_data"),a.indexpic&&(n.src=t.globalImgUrl(a.indexpic,70,70)),n.title=a.title,n.update_time=i.update_time,n.id=i.id,n.src||(n.src=""+t.ueditor.pluginDir+"/big_default.png"),e.push(n),console.log(e)},Settitle:function(t){switch(t){case this.typeList.VOD:return"点击插入此视频";case this.typeList.TUJI:return"点击插入此图集";case this.typeList.VOTE_QUESTION:return"点击插入此投票";case this.typeList.VOTE:return"点击插入此问卷"}},addSortList:function(e){var n=this,a=this.options,o=[],r={};t.isArray(e)?t.each(e,function(t,i){n._handleData(i,o)}):n._handleData(value,o),r.columnlist=o,r.sortlevel=this.sortlevel,r.tit=this.content,t.template("item_tpl",i.item_tpl),t.template("item_content",i.item_content);var s=t.tmpl("item_content",r).appendTo(a.slide),l=this.element.height()-s.find(".edit-slide-title").height()-10;s.find(".edit-slide-refer-content").height(l),"我发布的"==this.belongTopSortName?"2"==this.sortlevel&&t(".edit-slide-content:last").prepend(n.searchHtml):"1"==this.sortlevel&&t(".edit-slide-content:last").prepend(n.searchHtml),t(window).trigger("resize.slide")},setreferSlide:function(t){var i=this.options,e=t,n=e.closest(i.each);this.box.animate({left:"-="+(n.width()+20)+"px"},200)},_initPage:function(e){this.page=this.element.find(".item-page-wrap"),this.page.html(""),t.template("page_tpl",i.page_tpl),t.tmpl("page_tpl",e).appendTo(this.page),console.log(e,e.total_pages),e.total_pages>1?this.page.addClass("sys-flex"):this.page.hide()},_pageClick:function(i){var e=t(i.currentTarget),n=e.data("page"),a=e.data("type");n="previous"==a?n-1:n+1,this._ajaxPageData(e,n)},_ajaxPageData:function(i,e){var n=this;this.listbox=this.element.find(".item-list-wrap"),console.log(this.listbox);var a=this.options.config.model_materialUrl;a+="?model_id="+this.model_id+"&node_id="+this.node_id+"&page="+e,t.globalAjax(i,function(){return t.getJSON(a,function(t){n.listbox.html(""),n.addMaterialList(t,n.listbox)})})},_back:function(i){var e=this.options,n=t(i.currentTarget);this.sortlevel--;var a=n.closest(e.each);this.box.animate({left:"+="+(a.width()+20)+"px"},200,function(){a.remove()})},_click:function(i){var e=t(i.currentTarget),n=e.attr("_id"),a=this.imgCollection[n];this.insertImg("img",a)},insertRefer:function(i){var e=(this.options,this),n=t(i.currentTarget),a=n.find(".wrap-img"),o=this.options.config.referUrl,r=t.globalLoad(n),s={id:a.data("id")};t.ajax({url:o,type:"POST",data:s,error:function(t){r(),jAlert(t.responseJSON.error_message,"引用素材提示")},success:function(t){if(r(),t.material){var i=t.material.img_url,n=t.material.identifier,o='<p style="text-align:center;"><img m2o_mark= "'+n+'" class="image-refer" src= "'+i+'" /></p>';e.editor.execCommand("insertHtml",o)}else a.myTip({string:"插入失败"})}})},showEmpty:function(){var e={},n=this.options;e.tit=this.content,t.template("item_tpl",i.item_nodata),t.template("item_content",i.item_content),t.tmpl("item_content",e).appendTo(n.slide),t(window).trigger("resize.slide")},_initWater:function(){var i=this,e=this.options.config.modelUrl;setTimeout(function(){t.globalAjax(i.element,function(){return t.getJSON(e,function(t){t.user_models&&i._instance(t.user_models)})})},300)},_instance:function(e){var n=this,a=this.options,o=t(a.eachfirst).find(a.content),r=[];if(t.isArray(e)){if(0==e.length)return void n._showNoData();t.each(e,function(t,i){n._handleData(i,r)})}else n._handleData(e,r);t.template("item_tpl",i.item_tpl),
t.tmpl("item_tpl",r).appendTo(o)},_showNoData:function(){var e={},n=this.options;prebox=t(n.eachfirst).find(n.content),t.template("item_tpl",i.item_nodata),t.template("item_nodata_wrap",i.item_nodata_wrap),t.tmpl("item_nodata_wrap",e).appendTo(prebox)},_handleData:function(t,i){var e={};e.bundle=t.bundle?t.bundle:t.filename,this.modelid=t.id,e.name=t.name,e.level=this.sortlevel,e.islast=t.is_last,e.id=t.id,e.ismodel=Boolean(t.slug),i.push(e)}}),t.ueditor.m2oPlugins.add({cmd:"refer",title:"引用素材",click:function(i){t.editorPlugin.get(i,"refer").refer("show")}})}(jQuery),function(t){var i={template:'<ul><li class="refer-info-item refer-info-prev"><div class="refer-info-img-box {{= cname}}"><div class="middle-wrap refer-info-img-box"><img src="{{= imgUrl}}"/>{{if cname}}<p class="prev-btn">点击预览</p>{{/if}}</div></div></li><li class="refer-info-item-last"><a class="button_6 open-refer-event">{{= buttonLabel}}</a></li></ul>',css:".refer-info-item{border-bottom:1px solid #E7E7E7;padding:10px 7px;margin:0 10px;}.refer-info-item .name{color:#9f9f9f;display:inline-block;width:60px;text-align:right;margin-right:5px;}.refer-info-prev{text-align:center;}.refer-info-item-last{text-align: center;padding:10px 0;}.can-preview{cursor:pointer;}.open-refer-event{transition:none;cursor:pointer;color:#333;display:inline-block;width: 103px;background-position: -502px -5px;line-height: 26px !important;height: 26px !important;font-size: 12px;background-image:url("+t.ueditor.pluginDir+"/icon2.png);}.open-refer-event:hover{background-position: -502px -36px;}",cssInited:!1};t.widget("ueditor.referinfo",t.ueditor.baseWidget,{options:{title:"引用素材属性"},_create:function(){this._super()},_init:function(){this._super(),this._on({"click .can-preview":"_showSwf","click .open-refer-event":"_referChange"})},_referChange:function(){t.editorPlugin.get(this.editor,"refer").refer("show")},_showSwf:function(){var i=this._createSwf();t("<div>"+i+"</div>").dialog({modal:!0,dialogClass:"swf-dialog",resizable:!1,width:430,height:400,close:function(){t(this).dialog("destroy")}})},_createSwf:function(){var i="startTime=0&duration=227467&videoUrl=http://vfile1.dev.hogesoft.com/500x48/2013/02/1359683684581621.ssm/manifest.f4m&videoId=1821&snap=false&aspect=4:3&autoPlay=true&snapUrl=http://vapi1.dev.hogesoft.com:233/snap.php";return i=t.map(this.info,function(t,i){return i+"="+t}).join("&")+"&autoPlay=true",'<object type="application/x-shockwave-flash" data="'+RESOURCE_URL+'swf/vodPlayer.swf?11122713" width="400" height="330"><param name="movie" value="'+RESOURCE_URL+'swf/vodPlayer.swf?11122713"><param name="allowscriptaccess" value="always"><param name="allowFullScreen" value="true"><param name="wmode" value="transparent"><param name="flashvars" value="'+i+'"></object>'},_getReferInfo:function(){var i=this.options.config.materialInfoUrl,e=t(this.img).attr("src"),n=this;t.getJSON(i,{url:e},function(t){t||(t=[{type:"error"}]),n.info=t[0].flashvars;var i=t[0].type,e=n._getTitle(i);n.title.text(e),n._getContent(i,t[0])})},_getTitle:function(t){var i="";switch(t){case"vod":i="引用视频属性";break;case"tuji":i="引用图集属性";break;case"vote":i="引用投票属性";break;default:i="出错了"}return i},_getContent:function(e,n){var a={};switch(e){case"vod":a={buttonLabel:"替换这个视频",cname:"can-preview",attrs:{title:"标　题",time:"时　间"}};break;case"tuji":a={buttonLabel:"替换这个图集",attrs:{title:"标　题",time:"时　间"}};break;case"vote":a={buttonLabel:"替换这个投票",attrs:{title:"标　题",create_time:"创建时间",end_time:"结束时间"}}}a.imgUrl=n.img?t.globalImgUrl(n.img,"160x120"):"",this._template("refer_info_tpl",i,this.body.empty(),a);var o="";for(var r in a.attrs)o+='<li class="refer-info-item"><span class="name">'+a.attrs[r]+'：</span><span class="info">'+n[r]+"</span></li>";t(o).insertBefore(this.element.find(".refer-info-item-last"))},_empty:function(){this.body.empty()},refresh:function(t){this._empty(),this.img=t}})}(jQuery),function(t){t.widget("ueditor.removetag",t.ueditor.baseWidget,{options:{title:"清除格式"},_create:function(){this._super()},_init:function(){this._super()},refresh:function(i){var e=t(i.document);e.find("img").removeAttr("style"),this._removeFormat(i),this._centerImg(i)},_removeFormat:function(i){var e=t(i.document.body);e.find("img.before-biaozhu-ok, img.after-biaozhu-ok").remove(),e.find("img").each(function(){var i=t(this).clone(),e=t("<div></div>"),n=e.html(i).html();t(this).replaceWith("{{{"+encodeURIComponent(n)+"}}}"),e.remove()}),e.find("br").each(function(){t(this).replaceWith("{{{br}}}")}),e.find("span[style]").filter(function(){return"bold"==t(this).css("font-weight")}).add(e.find("b, strong")).each(function(){t(this).replaceWith("{{{strong}}}"+t.trim(t(this).text())+"{{{/strong}}}")}),e.find("p").each(function(){t(this).replaceWith("{{{p}}}"+t.trim(t(this).text())+"{{{/p}}}")});var n=e.text();n=n.replace(/({{{p}}}){1,}/g,"<p>"),n=n.replace(/({{{\/p}}}){1,}/g,"</p>"),n=n.replace(/({{{br}}}){1,}/g,"<br/>"),n=n.replace(/({{{strong}}}){1,}/g,"<strong>"),n=n.replace(/({{{\/strong}}}){1,}/g,"</strong>"),n=n.replace(/{{{([^}]*)}}}/g,function(t,i){return decodeURIComponent(i)}),e.html(n),e.find("img.pagebg").unwrap(),e.contents().filter(function(){return 3==this.nodeType}).wrap("<p></p>"),e.find("p").filter(function(){var i=t.trim(t(this).text()),e=t(this).has("img");return""==i&&!e.length}).remove(),e.find("br").filter(function(){var i=t(this),e=i.parent(),n=i.prev(),a=i.next(),o=e.prev(),r=e.next();return n.is("p")&&a.is("p")||o.is("p")&&r.is("p")}).remove(),i.sync(),i.fireEvent("contentChange")},_centerImg:function(i){var e=this,n=t(i.document).find("img");n.each(function(){var t=e.range();t.selectNode(this),t.select(),i.execCommand("justify","center")})}}),t.ueditor.m2oPlugins.add({cmd:"removetag",title:"清除格式",click:function(i){t.editorPlugin.get(i,"removetag").removetag("refresh",i)}})}(jQuery),function(t){t.widget("ueditor.native",t.ueditor.baseWidget,{options:{title:"正文原生化"},_create:function(){this._super()},_init:function(){this._super()},toogle:function(){t(".edui-for-native > .edui-default").hasClass("edui-state-checked")?t(".edui-for-native > .edui-default").removeClass("edui-state-checked"):t(".edui-for-native > .edui-default").addClass("edui-state-checked"),this.editor.fireEvent("_native")}}),t.ueditor.m2oPlugins.add({cmd:"native",title:"正文原生化",click:function(i){t.editorPlugin.get(i,"native")["native"]("toogle")}})}(jQuery);