"use strict";define(function(require){var app=require("app");require("common/directives/pager-redirect"),require("common/modal/modal-header"),require("common/modal/modal-footer"),app.controller("templatePreview",["$scope","$mdDialog","config","http","$rootScope","upload","localStorages","$log","utils",function($scope,$mdDialog,config,http,$rootScope,upload,localStorages,$log,utils){var vm=$scope.vm={};angular.extend(vm,{loading:!1,init:function(){vm.registerPage_data={},vm.get_registerPage_data()},set_registerPage_data:function(data){if(!angular.isObject(data))throw new Error("分享注册页面接口返回的数据result字段数据类型有误");vm.registerPage_data={background:data.background,brief:data.brief,qr_code:data.qr_code,app_name:$rootScope.appname},vm.loading="complete"},save_registerPage_data:function(){var url=config.getAdminAPI("invite_page");vm.loading=!1,http(url,{method:"POST",data:{background:vm.registerPage_data.background,brief:vm.registerPage_data.brief}}).then(function(res){res&&"0"===res.error_code?utils.success("保存成功").then(function(){$mdDialog.cancel()}):utils.error(res.error_message),vm.loading="complete"})},get_registerPage_data:function(){var url=config.getAdminAPI("invite_page");http(url,{method:"GET"}).then(function(res){if(res&&"0"===res.error_code){if(res.result)return res.result}else utils.error(res.error_message)}).then(function(data){vm.set_registerPage_data(data)})["catch"](function(error){$log.log(error)})},uploadPic:function(file,field){field.loading=!1;for(var url=config.getAPI("upload"),picConfig=this._getPicConfig(),i=0;i<file.length;i++)upload(url,file[i],picConfig.width,picConfig.height,"bodyPic").then(function(data){data&&data.url&&(vm.registerPage_data.background=data.url),field.loading="complete"})},_getPicConfig:function(){return config.picConfig.form_singlepic},close:function(){$mdDialog.cancel()}}),vm.init()}])});
