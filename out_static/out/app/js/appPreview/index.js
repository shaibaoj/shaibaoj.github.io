"use strict";define(function(require){require("./mainui"),require("./component");var moment=require("moment");require("appmake/services/appMakeService"),require("./services/appService");var app=require("app");app.controller("BaseCtrl",["$rootScope","$state","$stateParams","$scope","$window","config","utils","appService","appMakeService",function($rootScope,$state,$stateParams,$scope,$window,config,utils,appService,appMakeService){var vm=$scope.vm={};angular.extend(vm,{utils:utils,init:function(){vm.currentTime=moment(new Date).format("MM-DD hh:mm"),this.render(),$scope.$watch("$parent.vm.bigViews",function(newValue){newValue&&(vm.bigViews=newValue)},!0)},render:function(){this.loading=!1,this.moduleId=$stateParams.moduleId,this.initConfig(),this.pageFlag=this.moduleId?"module":"mainui"},getConfig:function(appId){var _this=this;appService.getConfig(appId).then(function(data){_this.appData=data.result,"module"==_this.pageFlag&&_this.initModuleType(),_this.loading="complete",_this.previewtpl=config.previewtpl[_this.pageFlag],_this.designComplete&&_this[_this.pageFlag+"Init"]&&_this[_this.pageFlag+"Init"]()})["catch"](function(){_this.loading="fail"})},initCardModule:function(ui){this.pageFlag="component";var component_config=angular.copy(this.appData.module_style[this.moduleId]);console.log(component_config,"config.component[ui]"),component_config.name=config.card_module[ui].name,component_config.itemCount=5,component_config.itemName=ui,this.appData.module_style[this.moduleId].components=[],this.appData.module_style[this.moduleId].components.push(component_config)},initFunctionModule:function(ui){this.pageFlag="module",this.ui=ui},initDiyModule:function(ui){this.pageFlag="component"},checkModuleType:function(){var ui=this.currentModuleInfo.ui,card_module_config=config.card_module,function_module_config=config.function_module,normal_module_config=config.component;card_module_config[ui]&&this.initCardModule(ui),(function_module_config[ui]||"h5"==this.currentModuleInfo.uiType)&&("h5"==this.currentModuleInfo.uiType&&(ui="html5"),this.initFunctionModule(ui)),(normal_module_config[ui]||"ListUI10"==ui)&&this.initDiyModule()},initModuleType:function(){var _this=this;angular.forEach(this.appData.main_ui.moduleList,function(value){value.id==_this.moduleId&&(_this.currentModuleInfo=value)}),this.checkModuleType()},initConfig:function(){this.getConfig()},moduleInit:function(){}}),$scope.$on("checkApp",function(event,first_appinfo){vm.init()}),$scope.$on("designComplete",function(event){vm.designComplete=!0,vm.render()})}])});