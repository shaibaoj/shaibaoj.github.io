"use strict";define(function(require){var app=require("app"),moment=require("moment");app.directive("contentReply",function(config,http,utils,upload){return{scope:{isshow:"=",contentId:"=",commentId:"=",comment:"=",currentReply:"=",data:"="},replace:!0,templateUrl:"common/directives/content-reply.html",link:function($scope){var vm=$scope.vm={};angular.extend(vm,{init:function(){$scope.data.submit_time=moment($scope.data.submit_time).format("YYYY-MM-DD HH:mm"),this.starconfig=config.assessconfig,this.replayImg=[],vm.loading="complete"},replay:function(){var url=config.getAPI("replyassess"),obj={content_id:$scope.contentId,comment_id:$scope.commentId,comment:$scope.comment,img:vm.replayImg};http(url,{method:"post",data:obj}).then(function(resp){+resp.error_code||($scope.currentReply="",utils.success("回复成功！"),vm.showContent=!1,$scope.data.reply.push(obj))})["catch"](function(resp){})},uploadFile:function(file,index){var url=config.getAPI("upload");vm.loading=!1,upload(url,file,null,null).then(function(resp){null!=index?vm.replayImg.splice(index,1,resp.url):vm.replayImg.push(resp.url),vm.loading="complete"},function(reason){utils.error("该图片上传失败!")})},addReply:function(){vm.showContent=!0},closebtn:function(){$scope.currentReply=""}}),vm.init()}}})});
