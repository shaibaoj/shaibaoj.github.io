"use strict";define(function(require){var app=require("app");require("common/services/record"),app.directive("dingdoneStatus",["$rootScope","record","config","getServerConfig",function($rootScope,record,config,getServerConfig){return{restrict:"EA",scope:{key:"@",params:"=",status:"="},replace:!0,templateUrl:"common/directives/status.html",link:function(scope,el,attrs){scope.loading="init",scope.getResult=function(){var color=config.colorConfig.status[scope.status];scope.status=+scope.status||0,scope.statusText=$rootScope.globalConfig.status[scope.status].title,scope.style={color:color}},scope.init=function(){$rootScope.initglobalConfig=$rootScope.initglobalConfig||"",$rootScope.initglobalConfig||($rootScope.initglobalConfig="init",getServerConfig.init().then(function(data){data&&data.configure&&($rootScope.globalConfig=data.configure)}))},scope.$watch("status",function(newValue,oldValue,scope){$rootScope.globalConfig&&scope.getResult()}),$rootScope.$watch("globalConfig",function(newValue,oldValue){newValue&&scope.getResult()}),el.on("click",function(){scope.loading=!1,record.updateRecordField(scope.status,scope.key,scope.params).then(function(data){data.error_code||(scope.status=data.data[0].data[scope.key],scope.getResult()),scope.loading="complete"})["catch"](function(){scope.loading="complete"})}),config.Appinfo?scope.init():$scope.$on("checkApp",function(event){scope.init()})}}}])});
