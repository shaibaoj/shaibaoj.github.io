"use strict";define(function(require){var app=require("app");require("common/services/modelService"),app.directive("insideNode",["config","http","utils","modelService",function(config,http,utils,modelService){return{scope:{node:"="},restrict:"EA",replace:!0,templateUrl:"common/directives/inside-node.html",link:function($scope){var vm=$scope.vm={};angular.extend(vm,{arr:[],isShow:!1,loading:"init",init:function(isReset){$scope.node.key&&this.initNodeName($scope.node.key),$scope.node.key=isReset?{}:$scope.node.key||{},this.nodesData=[],this.initModelList()},initNodeName:function(key){var arr=key.split(".");arr&&arr[1]&&modelService.getNodeName(arr[1]).then(function(data){vm.currentNode={id:arr[1],name:data}})},getNode:function(parent_id,arrIndex){var url=config.getAPI("nodechildren").replace("{model_id}",vm.currentModel.id).replace("{parent_id}",parent_id),_this=this;this.loading=!1,http(url).then(function(json){var arr=_this.nodesData,length=arr.length;arr.splice(arrIndex,length-arrIndex,json.nodes),_this.loading="complate",arr[0].length?vm.nodata=!1:vm.nodata=!0,vm.tapNode(!0)})},show:function(){this.isShow=!this.isShow},choose:function(obj){vm.currentNode=obj,vm.isShow=!1,$scope.node.value="",$scope.node.key="node."+obj.id,console.log($scope.node,"node choose")},currentLevel:0,maxCol:2,tapNode:function(flag){flag?vm.currentLevel=vm.currentLevel+vm.maxCol<vm.nodesData.length?vm.currentLevel+1:vm.currentLevel:vm.currentLevel=vm.currentLevel>0?vm.currentLevel-1:vm.currentLevel},changeModel:function(model){vm.currentModel=model,vm.isShow=!0,vm.nodesData=[],vm.getNode(0,0)},initModelList:function(){modelService.fetchModelList().then(function(data){vm.nodeModelList=data})}}),vm.init()}}}])});