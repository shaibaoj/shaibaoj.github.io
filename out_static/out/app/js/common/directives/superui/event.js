"use strict";define(function(require){var app=require("app");app.directive("dingdoneWidgetEvent",function(utils,config,http,$timeout){return{scope:{widget:"="},replace:!0,templateUrl:"common/directives/superui/event.html",link:function($scope,el,attrs){var vm=$scope.vm={};angular.extend(vm,{VIEWS:$scope.widget.VIEWS,root_view_id:$scope.widget.root_view_id,selected:[],allEvents:[],init:function(){vm.getEvents(),vm.initdata()},getEvents:function(){var url=config.getAdminAPI("pageManage.getEvents");http(url).then(function(resp){"0"==resp.error_code&&(vm.events=resp.result)})},close:function(){vm.isshow&&(vm.VIEWS[vm.root_view_id].__meta__.__listeners__=[])},initdata:function(){vm.VIEWS[vm.root_view_id].__meta__.__listeners__&&vm.VIEWS[vm.root_view_id].__meta__.__listeners__.length>0&&(vm.isshow=!0,vm.selected=vm.VIEWS[vm.root_view_id].__meta__.__listeners__)},toggle:function(event){var idx=vm.isRepeat(event),newevent={};idx?vm.selected.splice(idx,1):(newevent.uris=["dingdone://update_page"],newevent.notification=event.event,vm.selected.push(newevent)),vm.VIEWS[vm.root_view_id].__meta__.__listeners__=vm.selected},exists:function(event){return vm.isRepeat(event)},isRepeat:function(event){for(var i=0;i<vm.selected.length;i++)if(vm.selected[i].notification==event.event)return"0"==i?"0":i;return!1}}),vm.init()}}})});