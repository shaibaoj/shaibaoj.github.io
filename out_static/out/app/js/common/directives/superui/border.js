"use strict";define(function(require){var app=require("app");app.directive("dingdoneWidgetBorder",["mathService","config","colorService",function(mathService,config,colorService){return{scope:{widget:"="},replace:!0,templateUrl:"common/directives/superui/border.html",require:"?^dingdoneWidgetItem",link:function($scope,el,attrs,dingdoneWidgetItem){var vm=$scope.vm={};angular.extend(vm,{isShow:!1,effectPreview:{},direction:{top:"上",bottom:"下",left:"左",right:"右"},width:{},color:{},colorpickerOption:angular.extend(angular.copy(config.colorpickerDefault),{showAlpha:!0}),defaultColor:"#ffffffff",defaultWidth:0,init:function(){this.init={top:"init",bottom:"init",left:"init",right:"init"};var value=dingdoneWidgetItem.getValue()||{};for(var directionKey in vm.direction)vm.width[directionKey]=value[directionKey]&&value[directionKey].width||this.defaultWidth,vm.color[directionKey]=colorService.clientToRgba(value[directionKey]&&value[directionKey].color||this.defaultColor);vm.enabled=value.enabled,this.renderBox()},minusEnable:function(){return mathService.subtract(this.value,$scope.widget.step)>=$scope.widget.min},plusEnable:function(){return mathService.add(this.value,$scope.widget.step)<=$scope.widget.max},minus:function(){if(this.minusEnable()){var alreadyMin=this.value<=$scope.widget.min;this.value=alreadyMin?$scope.widget.min:mathService.subtract(this.value,$scope.widget.step)}},plus:function(){if(this.plusEnable()){var alreadyMax=this.value>=$scope.widget.max;this.value=alreadyMax?$scope.widget.max:mathService.add(this.value,$scope.widget.step)}},toggle:function(){vm.isShow=!vm.isShow},colorpickerChange:function(color,directionKey){color&&(this.refreshView(this.init[directionKey]),this.init[directionKey]=!1)},check:function(directionKey){this.refreshView()},renderBox:function(){if(vm.enabled){vm.effectPreview={};for(var directionKey in vm.direction)$scope.widget[directionKey].enable&&(vm.effectPreview["border-"+directionKey+"-width"]=vm.width[directionKey]+"px",vm.effectPreview["border-"+directionKey+"-color"]=vm.color[directionKey])}else vm.effectPreview={border:"none"}},refreshView:function(init){this.renderBox();var result={enabled:vm.enabled};for(var directionKey in vm.direction)result[directionKey]={width:vm.width[directionKey],color:colorService.rgbaToClient(vm.color[directionKey])};dingdoneWidgetItem.setValue(result,null,"init"!=init)}}),vm.init()}}}])});