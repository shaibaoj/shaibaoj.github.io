"use strict";define(function(require){var app=require("app");require("../string-to-number"),app.directive("dingdoneWidgetMargin",["mathService",function(mathService){return{scope:{widget:"="},replace:!0,templateUrl:"common/directives/superui/margin.html",require:"?^dingdoneWidgetItem",link:function($scope,el,attrs,dingdoneWidgetItem){var vm=$scope.vm={};angular.extend(vm,{initDirection:function(){var direction={top:"上",bottom:"下",left:"左",right:"右"};for(var key in direction)$scope.widget[key]&&$scope.widget[key].enable||delete direction[key];vm.direction=direction},isShow:!1,init:function(){this.initDirection(),this.step=$scope.widget.step,this.firstKey=Object.keys(vm.direction)[0],this.min=$scope.widget[this.firstKey].min,this.max=$scope.widget[this.firstKey].max,this.value=dingdoneWidgetItem.getValue(),this.compatible_string(),this.handleBatchValue(),!vm.allSame&&(vm.advanceIsShow=!0)},compatible_string:function(){isNaN(this.value)||(this.value={top:this.value,right:this.value,bottom:this.value,left:this.value})},toggle:function(){this.isShow=!this.isShow},minus:function(directionKey){var min=$scope.widget[directionKey].min,alreadyMin=this.value[directionKey]<=min;this.value[directionKey]=alreadyMin?min:mathService.subtract(this.value[directionKey],1)},plus:function(directionKey){var max=$scope.widget[directionKey].max,alreadyMax=this.value[directionKey]>=max;this.value[directionKey]=alreadyMax?max:mathService.add(this.value[directionKey],1)},batchminus:function(){var min=this.min,alreadyMin=this.batchVal<=min;this.batchVal=alreadyMin?min:mathService.subtract(this.batchVal,1)},batchplus:function(){var max=this.max,alreadyMax=this.batchVal>=max;this.batchVal=alreadyMax?max:mathService.add(this.batchVal,1)},check:function(directionKey){var max=$scope.widget[directionKey].max,min=$scope.widget[directionKey].min;this.value[directionKey]>max&&(this.value[directionKey]=max),this.value[directionKey]<min&&(this.value[directionKey]=min),this.handleBatchValue()},handleBatchValue:function(){if(vm.value){for(var same=!0,allKey=_.keys(vm.direction),allKeyLen=allKey.length,i=0;i<allKeyLen-1;i++){var num1=this.value[allKey[i]],num2=this.value[allKey[i+1]];same=same&&num1===num2}vm.allSame=same,vm.allSame&&(vm.batchVal=this.value[this.firstKey])}},showAdvance:function(){vm.advanceIsShow=!vm.advanceIsShow},dataCheck:function(value){return value>this.max&&(value=this.max),value<this.min&&(value=this.min),value},batch:function(){vm.allSame=!0,vm.batchVal=this.dataCheck(vm.batchVal);for(var directionKey in vm.direction)$scope.widget[directionKey]&&$scope.widget[directionKey].enable&&(vm.value[directionKey]=vm.batchVal);dingdoneWidgetItem.setValue(vm.value,null,!0)}}),vm.init(),$scope.$watch("vm.batchVal",function(newVal,oldVal){"undefined"==typeof newVal||angular.equals(newVal,oldVal)||void 0!==newVal&&vm.batch()})}}}])});