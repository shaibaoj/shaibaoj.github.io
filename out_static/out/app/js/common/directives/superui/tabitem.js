"use strict";define(function(require){require("../../../appmake/page_design/services/page_design_service"),require("../../../appmake/modal/page_design/setTabModal");var app=require("app");app.directive("dingdoneWidgetTabitem",function(PageDesignService,$compile,utils,$rootScope,config,http,$timeout){return{scope:{widget:"="},replace:!0,templateUrl:"common/directives/superui/tabitem.html",link:function($scope,element,attrs){var vm=$scope.vm={};angular.extend(vm,{VIEWS:$scope.widget.VIEWS,root_view_id:$scope.widget.root_view_id,attributeValues:{},init:function(){var uuid=vm.VIEWS[vm.root_view_id].tab_items[0];this.attributeValues=vm.VIEWS[uuid],this.initActive()},selectTab:function(tabItemKey){var _this2=this;vm.currentKey&&vm.currentKey==tabItemKey?(this.currentKey=null,element.find(".child-dingdone-widget-wrap").empty()):!function(){var _this=_this2;angular.forEach(vm.VIEWS[vm.root_view_id].tab_items,function(itemId){itemId!=tabItemKey&&(vm[itemId].isactive=!1)}),vm[tabItemKey].isactive=!vm[tabItemKey].isactive,vm.currentKey=tabItemKey,_this2.attributeValues=_this2.VIEWS[vm.currentKey],PageDesignService.getFormScheme("tabbar_item").then(function(json){_this.formScheme=json;var dom='<dingdone-widget form-scheme="vm.formScheme" dynamic-compile="true" attribute-values="vm.attributeValues"></dingdone-widget>';$compile(dom)($scope).appendTo(element.find(".child-dingdone-widget-wrap").empty())})}()},initActive:function(){angular.forEach(vm.VIEWS[vm.root_view_id].tab_items,function(itemId){vm[itemId]={},vm[itemId].isactive=!1})},openTabItemPop:function(){vm.opened=!0,vm.highsetModal.init()},itemLoading:{},highsetModal:{init:function(){var _this3=this;vm.tab_items=vm.VIEWS[vm.root_view_id].tab_items,vm.templateUrl="appmake/page_design/dingdone_widget_tpl.html",this.getChildPageList(function(){_this3.select(vm.current,0)})},getChildPageList:function(callback){var url=config.getAPI("pageManage.portfoliopagedetail").replace("{id}",$rootScope.pageId);http(url).then(function(json){vm.childList=json.result.nav_items,vm.current=vm.childList[0],callback&&callback()})},select:function(child,index){vm.current=child,vm.itemLoading[child.id]=!1,PageDesignService.getFormScheme("tabbar_item").then(function(json){vm.highsetformScheme=json,vm.highsetattrValues=vm.VIEWS[vm.tab_items[index]],$timeout(function(){vm.itemLoading[child.id]=!0},500)})},save:function(){vm.opened=!1},cancel:function(){vm.opened=!1}}}),vm.init()}}})});