"use strict";define(function(require){var app=require("app");app.factory("PageParamesService",function($q,utils,config,http){var services={};return angular.extend(services,{basket:{},getList:function(pageId,forbiddenCache){var defer=$q.defer(),_this=this;if(pageId)if(this.basket[pageId]&&!forbiddenCache)defer.resolve(_this.basket[pageId]);else{var url=config.getAPI("pageManage.getparames").replace("{module_id}",pageId);http(url).then(function(json){_this.basket[pageId]=json.result,defer.resolve(_this.basket[pageId])})}else defer.resolve([]);return defer.promise},addParam:function(pageId,paramString){var url=config.getAPI("pagedesign.createPageParam"),defer=$q.defer(),_this=this;return http(url,{method:"post",data:{module_id:pageId,name:paramString}}).then(function(json){_this.getList(pageId,!0).then(function(list){defer.resolve({theNew:json.result,list:list})})}),defer.promise},delParam:function(pageId,theKey){var url=config.getAPI("pagedesign.deletePageParam"),defer=$q.defer(),_this=this;return http(url,{method:"post",data:{module_id:pageId,key:theKey}}).then(function(){_this.getList(pageId).then(function(list){var allKeys=_.map(list,function(item){return item.key}),index=_.indexOf(allKeys,theKey);list.splice(index,1),defer.resolve(list)})}),defer.promise}}),services})});