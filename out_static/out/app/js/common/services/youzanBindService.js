"use strict";define(function(require){var app=require("app"),server=require("./server");require("common/services/localStroge"),app.controller("youzanBindModalCtrl",["$scope","utils","http","userService","$modalInstance","appMakeService","$state",function($scope,utils,http,userService,$modalInstance,appMakeService,$state){var vm=$scope.vm={};angular.extend(vm,{init:function(){this.bindYouzan(),vm.getBusinessInfo()},bindYouzan:function(){var url=userService.getAPI("getyouzantoken")+"?redirect_uri="+server.host+"index/youzancb";this.bindurl=url},getBusinessInfo:function(){appMakeService.getBusiness().then(function(resp){resp.error_code||(vm.businessinfo=resp.result)})},goBuy:function(){console.log(123),vm.businessinfo&&angular.isArray(vm.businessinfo)&&$state.go("mainLayout.noBusinessAuth"),vm.businessinfo&&!angular.isArray(vm.businessinfo)&&0==vm.businessinfo.is_confirm_pay&&$state.go("mainLayout.noBuyBusinessAuth"),vm.businessinfo&&!angular.isArray(vm.businessinfo)&&1==vm.businessinfo.is_confirm_pay&&$state.go("mainLayout.businessAuth"),$modalInstance.close()},close:function(){$modalInstance.close()}}),vm.init()}]).factory("youzanBindService",["$rootScope","$modal","http","config","localStorages",function($rootScope,$modal,http,config,locals){var vm={};return angular.extend(vm,{init:function(){vm.getYouzanShopInfo().then(function(resp){if(!resp.error_code){vm.shopinfo=resp.result.shop_info;var isbindsuccess=config.Appinfo.guid+vm.shopinfo.sid;localStorages.set(isbindsuccess,!0),angular.isArray(vm.shopinfo)&&!vm.shopinfo.length&&vm.openYouzanBindModal()}})},getYouzanShopInfo:function(){var url=config.getAPI("getshopinfo");return http(url)},openYouzanBindModal:function(){$modal.open({animateanimation:!0,size:800,templateUrl:"common/modal/youzanBindModal.html",controller:"youzanBindModalCtrl"})}}),{getYouzanShopInfo:vm.getYouzanShopInfo,init:vm.init}}])});