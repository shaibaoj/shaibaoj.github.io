"use strict";define(function(require){var app=require("app");require("interactive/modal/setGroupManageModal"),app.controller("groupManageCtrl",["$scope","navconfig","utils","http","config",function($scope,navconfig,utils,http,config){var vm=$scope.vm={};angular.extend(vm,{init:function(){vm.getGroupList()},getGroupList:function(){var url=config.getAdminAPI("groupmanage.getgrouplist");vm.loading=!1,http(url).then(function(res){var data=res.result;data.data&&(vm.groupList=data.data,vm.loading="complete")})},editGroup:function(group){vm.addGroupDialog(group)},delGroup:function(id,index){utils.confirm({headTitle:"删除提示",msg:"确定要删除该群组?"},function(sure){if(sure){var url=config.getAdminAPI("groupmanage.deletegroup").replace("{group_id}",id);vm.loading=!1,http(url,{method:"delete"}).then(function(data){data.error_code&&data.error_message?utils.error(data.error_message):(vm.groupList.splice(index,1),utils.success("删除群组成功 ！")),vm.loading="complete"})}})},addGroupDialog:function(group){utils.mdDialog({controller:"setGroupManageCtrl",templateUrl:"interactive/modal/setGroupManageModal.html",clickOutsideToClose:!0,locals:{modalData:{group:group}}}).then(function(obj){vm.updataPage(obj)})},updataPage:function(obj){obj.createGroupInfo?(vm.groupList.push(obj.createGroupInfo),utils.success("添加群组成功 ！")):obj.newGroupInfo&&obj.newGroupInfo.id&&(angular.forEach(vm.groupList,function(val){val.id==obj.newGroupInfo.id&&(val.name=obj.newGroupInfo.name,val.icon=obj.newGroupInfo.icon,val.maximum=obj.newGroupInfo.maximum)}),utils.success("更新群组成功 ！"))}}),$scope.$on("checkApp",function(event,first_appinfo){vm.init()})}])});