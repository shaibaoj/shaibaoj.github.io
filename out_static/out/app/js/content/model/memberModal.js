"use strict";define(function(require){var app=require("app");app.controller("MemberModalCtrl",["$scope","$mdDialog","config","http","params","utils",function($scope,$mdDialog,config,http,params,utils){var vm=$scope.vm={};angular.extend(vm,{init:function(){vm.getDataList(!0),vm.selectRecordlList=params.selectRecordlList,vm.widget=params.widget,console.log(vm.selectRecordlList)},getDataList:function(flag){var url=config.getAdminAPI("allmemberlist");http(url,{method:"get",params:vm.searchParams}).then(function(data){0==data.error_code&&(vm.allMemberTotalNumber=data.result.total,vm.loading="complete",vm.handleGroup(data,flag))})},handleGroup:function(data,flag){if(flag){var options={per_page:20,current_page:1,total:data.result.total,total_pages:Math.ceil(data.result.total/20)};vm.initPagination(options)}data.result.data&&data.result.data.length&&angular.forEach(data.result.data,function(vv){null==vv.last_login?vv.time="--:--:--":vv.time=utils.formatDate(vv.last_login,"YYYY-MM-DD hh:mm:ss"),"admin_end"==vv.source?vv.source="制作端":"client_end"==vv.source&&(vv.source="客户端"),vv.member_groups.length||(vv.member_groups=[{name:"普通会员"}])}),vm.listData=data.result.data,A.forEach(vm.listData,function(list){A.forEach(vm.selectRecordlList,function(val){list.id==val.id&&(list.isCheck=!0)})})},initPagination:function(options){vm.pagination={totalItems:options.total,numPages:options.total_pages,itemsPerPage:options.per_page,maxSize:options.total_pages,currentPage:options.current_page}},watchCurrentPage:function(){$scope.$watch("vm.pagination.currentPage",function(currentpage,old){currentpage&&old&&vm.getDataList(!1,vm.searchParams)})},check:function(index){return"refer_user"==vm.widget&&vm.selectRecordlList.length>=1&&!vm.listData[index].isCheck?void utils.error("该会员组只能选择一名会员!"):(vm.listData[index].isCheck=!vm.listData[index].isCheck,void(vm.listData[index].isCheck?this.addItem(vm.listData[index]):this.delItem(vm.listData[index])))},addItem:function(item){var bool=!1;angular.forEach(vm.selectRecordlList,function(record,key){record.id==item.id&&(bool=!0)}),bool||vm.selectRecordlList.push(item)},delItem:function(item){var index=-1;angular.forEach(vm.selectRecordlList,function(record,key){record.id==item.id&&(index=key)}),index!=-1&&vm.selectRecordlList.splice(index,1)},save:function(){$mdDialog.hide({selectRecordlList:vm.selectRecordlList})}}),vm.init()}])});
